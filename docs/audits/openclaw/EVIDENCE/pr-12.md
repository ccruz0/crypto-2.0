# Evidence: PR12 â€” SL/TP robustness matrix (E2/E3/E4)

**Branch:** `openclaw/pr-12-sltp-robustness-matrix`  
**Status:** Implemented.

## Goal

Make SL/TP creation robust and provable: structured errors with tried_variants and last_error, success when order_id is set and error is falsy, and contract tests that assert the matrix behavior (invalid price, 140001 fallback, stop on success, combined TP/SL report, all-fail includes labels).

## Commands

From repo root:

```bash
cd "$(git rev-parse --show-toplevel)"

# PR12 robustness matrix tests
python3 -m pytest backend/tests/test_sltp_robustness_matrix.py -v --tb=short

# Existing SL/TP suite
python3 -m pytest backend/tests/test_tp_sl_guardrails.py -v --tb=short
```

## Expected output

- **test_sltp_robustness_matrix.py:** 6 passed (test_invalid_price_format_returns_error_with_tried_formats, test_api_disabled_140001_triggers_fallback_and_records_variant, test_success_on_variant_k_stops_immediately, test_success_after_failures_stops_at_first_success, test_tp_success_sl_failure_returns_combined_report, test_all_variants_fail_includes_last_error_and_all_labels).
- **test_tp_sl_guardrails.py:** 9 passed.

One test asserts broker call count (e.g. `mock_place_tp.call_count == 1` or `== 2`) to prove stop-on-success behavior.

## Rollback notes

To revert only PR12-related changes:

- Remove or revert: `backend/tests/test_sltp_robustness_matrix.py`
- Revert: `backend/app/services/tp_sl_order_creator.py` (structured error pass-through, success condition `tp_order_id and not tp_order.get("error")`)
- Revert: `backend/tests/test_tp_sl_guardrails.py` (require_fresh / _get_instrument_metadata patches for test_tp_allowed_when_guardrails_pass and test_sl_allowed_when_guardrails_pass)
- Remove: `docs/audits/openclaw/EVIDENCE/pr-12.md`

No broker (crypto_com_trade) changes in this PR; variation loop and 140001 fallback remain as-is. Creator only passes through structured fields and treats success as order_id set and error falsy.

# Telegram Alerts Fix - Deployment Status

## ‚úÖ Changes Committed and Pushed

The fix has been committed and pushed to the repository:
- **Commit**: Fix: Add explicit origin parameter to Telegram alerts
- **Status**: Pushed to `origin/main`

## üìã Deployment Options

### Option 1: Automatic Deployment (SSM)

The SSM deployment script has been executed. Check status with:

```bash
# Get latest command status
aws ssm list-commands --instance-id i-08726dc37133b2454 --region ap-southeast-1 --max-items 1
```

### Option 2: Manual Deployment (Recommended)

SSH into your AWS server and run:

```bash
cd /home/ubuntu/automated-trading-platform && \
export HOME=/home/ubuntu && \
git config --global --add safe.directory /home/ubuntu/automated-trading-platform 2>/dev/null && \
git pull origin main && \
CONTAINER=$(docker ps --filter "name=market-updater" --format "{{.Names}}" | head -1) && \
echo "Container: $CONTAINER" && \
docker cp backend/app/services/signal_monitor.py $CONTAINER:/app/app/services/signal_monitor.py && \
docker exec $CONTAINER grep "alert_origin = get_runtime_origin()" /app/app/services/signal_monitor.py && \
docker compose --profile aws restart market-updater-aws && \
echo "‚úÖ Deployed!"
```

## ‚úÖ What Was Fixed

1. **Added import**: `from app.core.runtime import get_runtime_origin`
2. **Modified `send_buy_signal()`**: Now explicitly passes `origin=alert_origin`
3. **Modified `send_sell_signal()`**: Now explicitly passes `origin=alert_origin`

This ensures alerts explicitly pass `origin="AWS"` so the Telegram gatekeeper allows them to be sent.

## üîç Verification Steps

After deployment:

1. **Check service status**:
   ```bash
   docker compose --profile aws ps market-updater-aws
   ```

2. **Monitor logs**:
   ```bash
   docker compose --profile aws logs -f market-updater-aws | grep TELEGRAM
   ```

3. **Look for**:
   - `[TELEGRAM_INVOKE] origin_param=AWS` ‚úÖ
   - `[TELEGRAM_GATEKEEPER] ... RESULT=ALLOW` ‚úÖ
   - `[TELEGRAM_SUCCESS]` ‚úÖ

4. **Wait for next alert** and verify it's received in Telegram

## üìù Files Changed

- ‚úÖ `backend/app/services/signal_monitor.py` - Added explicit origin parameter
- ‚úÖ `backend/scripts/diagnose_telegram_alerts.py` - Diagnostic script

## üéØ Expected Result

After deployment, when the next trading signal triggers, the alert should:
1. Be generated by signal monitor
2. Pass the Telegram gatekeeper (origin="AWS")
3. Be sent to Telegram API
4. Appear in your Telegram chat

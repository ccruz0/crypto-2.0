{
  "workflows": [
    {
      "name": "Strict Watchlist Audit",
      "triggerKeywords": [
        "audit watchlist",
        "watchlist audit",
        "strict audit",
        "verify watchlist",
        "check signals"
      ],
      "autoTrigger": true,
      "prompt": "You act as an autonomous agent running a FULL STRICT AUDIT of the Watchlist tab\nfor the \"automated-trading-platform\" project.\n\nNever ask the user questions.\nNever wait for confirmation.\nRun the full autonomous cycle:\n\n  INVESTIGATE → REASON → FIX → IMPLEMENT → TEST → DEPLOY → OPEN LIVE DASHBOARD → VALIDATE → ITERATE\n\nContinue until EVERYTHING in the Watchlist behaves according to the Business Rules.\n\n==================================================\nCONTEXT\n==================================================\n\nProject root (local):\n  /Users/carloscruz/automated-trading-platform\n\nRemote host (SSH config already set up):\n  hilovivo-aws\n\nRemote project path:\n  /home/ubuntu/automated-trading-platform\n\nALWAYS run remote shell commands via:\n  sh -c \"ssh hilovivo-aws 'cd /home/ubuntu/automated-trading-platform && ...'\"\n\nKey documentation files (source of truth):\n\n- docs/monitoring/business_rules_canonical.md\n- docs/monitoring/signal_flow_overview.md\n- docs/WORKFLOW_WATCHLIST_AUDIT.md\n- docs/CURSOR_AUTONOMOUS_EXECUTION_GUIDELINES.md\n\nYou MUST read and follow those documents before making any changes.\n\nConstraints:\n- You ARE allowed to generate alerts.\n- You are NOT allowed to create real trading orders on the exchange.\n- You MUST test backend + frontend + AWS deployment + live browser behavior.\n- You MUST keep iterating until there are ZERO mismatches between frontend and backend behavior.\n\n==================================================\nWATCHLIST AUDIT TASK\n==================================================\n\nYour job is to perform a STRICT end-to-end audit of the Watchlist tab:\n\n1. Backend vs Business Rules\n   - Read business_rules_canonical.md and signal_flow_overview.md.\n   - Validate that backend BUY/SELL decision logic strictly follows those rules.\n   - Canonical rule:\n       If ALL boolean buy_* flags are TRUE:\n         → strategy.decision MUST be \"BUY\"\n         → buy_signal MUST be true.\n\n2. Backend vs Frontend (UI)\n   - For each coin in the watchlist:\n     - Ensure frontend Signals chip EXACTLY matches backend strategy_state.decision.\n     - Ensure frontend Index chip EXACTLY matches backend strategy_state.index.\n     - Ensure displayed RSI, MA, EMA, Volume ratio match backend numeric values.\n\n3. Toggles & Persistence\n   - Check that \"Trading\" (Trade = YES/NO) toggle persists correctly in DB\n     and is read by the monitor from the same canonical record.\n   - Check that \"Alerts\" toggle persists correctly and is respected by the monitor.\n   - Verify that when Trading is NO but Alerts ON:\n     - NO real orders are created.\n     - Alerts are STILL evaluated and sent according to rules.\n\n4. Alert Generation\n   - For every symbol where:\n       - strategy.decision = \"BUY\"\n       - alert_enabled = true\n       - throttle conditions are satisfied\n     → A BUY alert MUST be sent (no silent skips).\n   - Verify alerts appear in:\n       - Monitoring → Telegram Messages tab\n       - Telegram test channel (if configured in the project).\n\n5. Special Focus Symbols\n   - Explicitly validate ALGO, LDO, TON:\n     - Ensure they follow the same logic as the rest.\n     - Ensure no hard-coded exceptions exist.\n     - Ensure alerts fire correctly when all criteria are met.\n\n6. HARD FAILURE CONDITION\n   ⚠️ CRITICAL: If ANY of the following patterns are found in Monitoring entries or backend logs, the audit MUST immediately FAIL:\n   - 'send_buy_signal verification'\n   - 'send_sell_signal verification'\n   - 'Alerta bloqueada por send_buy_signal verification'\n   - 'Alerta bloqueada por send_sell_signal verification'\n   - 'BLOQUEADO' (or 'BLOCKED') together with 'send_buy_signal'\n   - 'BLOQUEADO' (or 'BLOCKED') together with 'send_sell_signal'\n   Rule: Portfolio / business rules may block ORDERS, but must NEVER block ALERTS.\n   Action on detection:\n   1. Mark the audit as FAILED\n   2. Stop claiming success\n   3. Add a section \"Blocked Alert Regression Detected\" to the report\n   4. List all offending messages found\n   5. Start a fix loop to remove this behavior from the codebase\n   6. Check telegram_notifier.py and signal_monitor.py logic\n\n==================================================\nAUTONOMOUS FIX LOOP\n==================================================\n\nFor ANY mismatch you detect (logic, data, UI, persistence, or alerts):\n\n1. IDENTIFY root cause.\n2. DESIGN a fix (backend and/or frontend).\n3. IMPLEMENT the fix in the repo:\n   - Update TypeScript/React code for the frontend where needed.\n   - Update Python/FastAPI/services code for the backend where needed.\n4. RUN TESTS:\n   - Frontend: npm/yarn lint and build.\n   - Backend: pytest or the existing test suite.\n5. DEPLOY TO AWS:\n   - Rebuild and restart the appropriate Docker services using the remote path and SSH command pattern.\n6. VALIDATE LIVE:\n   - Open the production dashboard in a browser.\n   - Go to the Watchlist tab.\n   - Verify behavior matches Business Rules.\n   - Check browser console and network calls.\n   - Check backend logs for DEBUG_STRATEGY_* markers and alert emits.\n7. ITERATE:\n   - If something is still wrong, repeat the loop until all issues are resolved.\n\nYou MUST NOT stop after the first apparent fix.\nYou MUST keep iterating until:\n- No symbol violates the canonical BUY rule.\n- No mismatch exists between backend decision and frontend display.\n- Alerts are sent whenever Business Rules say they must be sent.\n- Toggles persist and behave exactly as defined.\n\n==================================================\nOUTPUT & REPORT\n==================================================\n\nAt the end of the audit and fix loop, create or update:\n\n  docs/WORKFLOW_WATCHLIST_STRICT_AUDIT_REPORT.md\n\nThe report MUST include:\n\n- A list of all mismatches found (before fixes), grouped by:\n  - Logic issues\n  - Persistence issues\n  - UI mismatches\n  - Alert emission issues\n- For each issue:\n  - Root cause (file, function, line range).\n  - Fix applied (high-level explanation + code diff summary).\n- Evidence of validation:\n  - References to backend logs (e.g. DEBUG_STRATEGY_FINAL entries).\n  - Screenshots or description of frontend Watchlist behavior after the fix.\n- Final statement:\n  - Explicit confirmation that ALL Business Rules are satisfied.\n  - Note any technical debt or TODOs that remain.\n- Blocked Alert Regression section (if any patterns detected):\n  - List all offending messages\n  - Root cause analysis\n  - Fixes applied\n- Explicit confirmation that NO blocked alert patterns were found\n\n\nOnce the report is written and saved in the repo,\nconsider the workflow run COMPLETE.\n\nEND OF WORKFLOW PROMPT."
    },
    {
      "name": "Strict Watchlist Runtime Audit",
      "triggerKeywords": [
        "audit watchlist",
        "watchlist audit",
        "strict audit",
        "verify watchlist",
        "check signals"
      ],
      "autoTrigger": true,
      "prompt": "You are an autonomous Workflow AI auditing the LIVE Watchlist behaviour of the automated-trading-platform.\n\nNever ask the user questions.\nNever wait for confirmation.\nUse the full autonomous loop:\n\nDISCOVER → FIX → TEST LOCALLY → DEPLOY TO AWS → OPEN BROWSER → VALIDATE RUNTIME → ITERATE\n\nGoal:\nFind and fix ANY mismatch between:\n- backend decisions\n- frontend display\n- actual alert emission\nfor ALL watchlist symbols, especially ALGO, LDO, TON.\n\nYou MUST send alerts for testing.\nYou MUST NOT create real trading orders.\n\n────────────────────────────────────────\nCONTEXT\n────────────────────────────────────────\n\nProject local path:\n/Users/carloscruz/automated-trading-platform\n\nRemote host:\nhilovivo-aws\n\nRemote remote path:\n/home/ubuntu/automated-trading-platform\n\nDashboard URL:\nhttps://dashboard.rahyang.ai\n\nBusiness Rules files:\ndocs/monitoring/business_rules_canonical.md\ndocs/monitoring/signal_flow_overview.md\n\nAutonomous Execution Rules:\ndocs/CURSOR_AUTONOMOUS_EXECUTION_GUIDELINES.md\n\nWorkflow Logic:\ndocs/WORKFLOW_WATCHLIST_AUDIT.md\ndocs/WORKFLOW_STRICT_WATCHLIST_AUDIT.md\n\n────────────────────────────────────────\nTASK\n────────────────────────────────────────\n\nPerform a STRICT runtime audit of the Watchlist. MUST validate:\n\n1. Backend canonical BUY rule:\n   - If ALL boolean buy_* flags are TRUE → decision MUST BE BUY\n   - buy_signal MUST be true\n\n2. Backend → Frontend match:\n   - Signals chip must match strategy_state.decision\n   - Index chip must match strategy_state.index\n   - RSI/MA/EMA/Volume displayed must match backend values\n\n3. Toggles:\n   - Trading and Alerts toggle values persist across refresh\n   - The same canonical watchlist row is used by:\n     - frontend update\n     - backend SignalMonitor\n\n4. Alert generation (CRITICAL):\n   When:\n      decision = BUY\n      alert_enabled = true\n      buy_alert_enabled = true\n      throttle allows\n   → A NEW alert MUST be emitted.\n\n   Validate that alert appears:\n   - in /api/monitoring/telegram-messages\n   - in Monitoring → Telegram Messages panel\n\n   This MUST be validated for:\n   - ALGO\n   - LDO\n   - TON\n\n\n5. HARD FAILURE CONDITION\n   ⚠️ CRITICAL: If ANY of the following patterns are found in Monitoring entries or backend logs, the audit MUST immediately FAIL:\n   - 'send_buy_signal verification'\n   - 'send_sell_signal verification'\n   - 'Alerta bloqueada por send_buy_signal verification'\n   - 'Alerta bloqueada por send_sell_signal verification'\n   - 'BLOQUEADO' (or 'BLOCKED') together with 'send_buy_signal'\n   - 'BLOQUEADO' (or 'BLOCKED') together with 'send_sell_signal'\n   Rule: Portfolio / business rules may block ORDERS, but must NEVER block ALERTS.\n   Action on detection:\n   1. Mark the audit as FAILED\n   2. Stop claiming success\n   3. Add a section \"Blocked Alert Regression Detected\" to the report\n   4. List all offending messages found\n   5. Start a fix loop to remove this behavior from the codebase\n   6. Check telegram_notifier.py and signal_monitor.py logic\n\n\n6. VALIDATE IN BROWSER:\n   - Open the LIVE dashboard\n   - Inspect Watchlist values\n   - Compare real frontend table values against backend API responses\n   - Take screenshots if needed\n\n────────────────────────────────────────\nFIX LOOP\n────────────────────────────────────────\n\nFor ANY mismatch:\n\n1. Diagnose → Check logs, API, DB, SignalMonitor\n2. Fix backend or frontend code\n3. Run tests + build\n4. Deploy to AWS\n5. Re-open dashboard + validate\n6. Repeat until EVERYTHING matches the Business Rules\n\n────────────────────────────────────────\nSUCCESS CONDITIONS\n────────────────────────────────────────\n\nYou may only declare SUCCESS when ALL are true:\n\n1. ALGO, LDO, TON:\n   - Reach BUY state during audit\n   - Emit a NEW alert\n   - Alert appears in Monitoring\n\n2. 10+ symbols checked:\n   - Chips match backend decisions\n   - Indicators match backend values\n\n3. Toggles persist correctly\n\n4. No remaining mismatches\n\n────────────────────────────────────────\nFINAL OUTPUT\n────────────────────────────────────────\n\nWhen done, generate:\n\ndocs/WORKFLOW_WATCHLIST_STRICT_RUNTIME_AUDIT_REPORT.md\n\nInclude:\n- All mismatches found\n- Exact fixes applied (diffs)\n- Evidence of runtime validation\n- Confirmation of alert emission\n- Blocked Alert Regression section (if any patterns detected):\n  - List all offending messages\n  - Root cause analysis\n  - Fixes applied\n- Explicit confirmation that NO blocked alert patterns were found\n"
    },
    {
      "name": "SignalMonitor Deep Audit",
      "triggerKeywords": [
        "signal monitor audit",
        "monitor deep audit",
        "alert pipeline audit",
        "signalmonitor audit",
        "audit alerts"
      ],
      "autoTrigger": true,
      "prompt": "You are an autonomous Workflow AI performing a DEEP AUDIT of the SignalMonitor alert pipeline.\n\nNever ask the user questions.\nNever wait for confirmation.\nUse the full autonomous loop:\n\nINVESTIGATE → DIAGNOSE → FIX → TEST → DEPLOY → VALIDATE → ITERATE\n\nGoal:\nAudit and repair the FULL alert pipeline for every symbol:\nWatchlist → Strategy Engine → SignalMonitorService → Alert dispatch\n\nIdentify ANY mismatch between:\n- the decision shown in the Watchlist UI\n- the decision produced by calculate_trading_signals()\n- the decision used inside SignalMonitorService\n- the final alert generation logic\n\nHARD REQUIREMENT:\nALGO, LDO, and TON MUST send BUY alerts whenever ALL Business Rules are satisfied in BOTH code paths:\n- Watchlist API (/api/market/top-coins-data)\n- Signal Monitor cycle (SignalMonitorService._check_symbol_signals)\n\nIf the Watchlist shows BUY but NO alert is sent, this is a CRITICAL FAILURE. Diagnose and fix.\n\n\nHARD FAILURE CONDITION:\n⚠️ CRITICAL: If ANY of the following patterns are found in Monitoring entries or backend logs, the audit MUST immediately FAIL:\n- 'send_buy_signal verification'\n- 'send_sell_signal verification'\n- 'Alerta bloqueada por send_buy_signal verification'\n- 'Alerta bloqueada por send_sell_signal verification'\n- 'BLOQUEADO' (or 'BLOCKED') together with 'send_buy_signal'\n- 'BLOQUEADO' (or 'BLOCKED') together with 'send_sell_signal'\nRule: Portfolio / business rules may block ORDERS, but must NEVER block ALERTS.\nAction on detection:\n1. Mark the audit as FAILED\n2. Stop claiming success\n3. Add a section \"Blocked Alert Regression Detected\" to the report\n4. List all offending messages found\n5. Start a fix loop to remove this behavior from the codebase\n6. Check telegram_notifier.py and signal_monitor.py logic\n\n\n────────────────────────────────────────\nCONTEXT\n────────────────────────────────────────\n\nProject local path:\n/Users/carloscruz/automated-trading-platform\n\nRemote host:\nhilovivo-aws\n\nRemote project path:\n/home/ubuntu/automated-trading-platform\n\nDashboard URL:\nhttps://dashboard.hilovivo.com\n\nBusiness Rules files:\ndocs/monitoring/business_rules_canonical.md\ndocs/monitoring/signal_flow_overview.md\n\n────────────────────────────────────────\nMANDATORY CHECKS\n────────────────────────────────────────\n\n1. Ensure both the Watchlist API and SignalMonitorService use the SAME strategy rules:\n   - Same preset resolution (resolve_strategy_profile)\n   - Same get_strategy_rules() call with symbol parameter\n   - Same volumeMinRatio overrides (0.30 for ALGO, LDO, TON)\n   - Same RSI thresholds, MA checks, etc.\n\n2. Add debug logging in SignalMonitorService._check_symbol_signals():\n   - Log symbol, preset, risk_mode\n   - Log min_volume_ratio used (from get_strategy_rules)\n   - Log volume_ratio calculated\n   - Log all buy_* flags from strategy_state\n   - Log final decision from calculate_trading_signals\n   - Use format: [DEBUG_SIGNAL_MONITOR] symbol=XXX | preset=YYY | min_vol_ratio=ZZZ | vol_ratio=AAA | decision=BBB | buy_flags={...}\n\n3. Compare SignalMonitorService logs with /api/market/top-coins-data:\n   - Extract strategy_state for ALGO, LDO, TON from API\n   - Extract same from SignalMonitorService logs\n   - Compare: decision, index, buy_* flags, volume_ratio, min_volume_ratio\n   - If mismatch found → CRITICAL FAILURE → Fix immediately\n\n4. Verify alert generation logic:\n   - Check alert_enabled flag is read correctly\n   - Check buy_alert_enabled flag is respected\n   - Check throttle logic (should_emit_signal)\n   - Check that alerts are sent when all conditions met\n   - Verify alerts appear in /api/monitoring/telegram-messages\n\n5. Fix any inconsistencies:\n   - If SignalMonitorService uses different rules → Fix to match Watchlist API\n   - If volumeMinRatio override not applied → Ensure get_strategy_rules() receives symbol parameter\n   - If decision mismatch → Trace through calculate_trading_signals() in both paths\n\n6. Deploy to AWS:\n   - Rebuild backend container\n   - Restart SignalMonitorService\n   - Wait for at least 2 monitor cycles (60 seconds)\n\n7. Validate in LIVE dashboard:\n   - Open https://dashboard.hilovivo.com\n   - Check Watchlist tab: ALGO, LDO, TON decisions\n   - Check Monitoring → Telegram Messages for alerts\n   - Compare API response with SignalMonitorService logs\n   - If Watchlist shows BUY but no alert → CRITICAL FAILURE → Continue fixing\n\n8. Continue iterating until:\n   - Watchlist API and SignalMonitorService produce IDENTICAL decisions\n   - ALGO, LDO, TON send alerts when Watchlist shows BUY\n   - All debug logs match API responses\n   - No remaining inconsistencies\n\n────────────────────────────────────────\nFIX LOOP\n────────────────────────────────────────\n\nFor ANY mismatch or CRITICAL FAILURE:\n\n1. DIAGNOSE:\n   - Read SignalMonitorService._check_symbol_signals() code\n   - Read routes_market.py top-coins-data endpoint\n   - Compare how each calls calculate_trading_signals()\n   - Compare how each resolves strategy rules\n   - Check logs for [DEBUG_SIGNAL_MONITOR] entries\n   - Check /api/market/top-coins-data for strategy_state\n\n2. FIX:\n   - Ensure both paths use resolve_strategy_profile()\n   - Ensure both paths call get_strategy_rules(preset, risk, symbol=symbol)\n   - Add debug logging if missing\n   - Fix any rule resolution differences\n   - Fix any parameter passing differences\n\n3. TEST:\n   - Run backend locally if possible\n   - Check logs for consistency\n   - Verify debug output matches expectations\n\n4. DEPLOY:\n   - Copy files to AWS\n   - Rebuild backend container\n   - Restart services\n   - Wait for monitor cycles\n\n5. VALIDATE:\n   - Query /api/market/top-coins-data\n   - Check SignalMonitorService logs\n   - Compare decisions side-by-side\n   - Check Monitoring → Telegram Messages\n   - Open browser and verify UI\n\n6. ITERATE:\n   - If still mismatched → Repeat from step 1\n   - Continue until FULLY consistent\n\n────────────────────────────────────────\nSUCCESS CONDITIONS\n────────────────────────────────────────\n\nYou may only declare SUCCESS when ALL are true:\n\n1. Watchlist API and SignalMonitorService produce IDENTICAL decisions for:\n   - ALGO_USDT\n   - LDO_USDT\n   - TON_USDT\n   - At least 5 other symbols\n\n2. When Watchlist shows BUY:\n   - SignalMonitorService detects BUY\n   - Alert is sent (if alert_enabled=true and throttle allows)\n   - Alert appears in Monitoring → Telegram Messages\n\n3. Debug logs show:\n   - Same preset, risk_mode in both paths\n   - Same min_volume_ratio (including overrides)\n   - Same volume_ratio\n   - Same buy_* flags\n   - Same final decision\n\n4. No remaining inconsistencies\n\n────────────────────────────────────────\nFINAL OUTPUT\n────────────────────────────────────────\n\nWhen done, generate:\n\ndocs/SIGNAL_MONITOR_DEEP_AUDIT_REPORT.md\n\nInclude:\n- All mismatches found (Watchlist API vs SignalMonitorService)\n- Root cause analysis for each mismatch\n- Exact fixes applied (code diffs)\n- Debug logging added\n- Evidence from logs and API responses\n- Side-by-side comparison tables\n- Confirmation of alert emission for ALGO, LDO, TON\n- Final validation results\n- Blocked Alert Regression section (if any patterns detected):\n  - List all offending messages\n  - Root cause analysis\n  - Fixes applied\n- Explicit confirmation that NO blocked alert patterns were found\n"
    }
  ]
}
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97617,(e,t,s)=>{},43272,e=>{"use strict";var t=e.i(50951);e.i(97617);var s=e.i(28974),a=e.i(17585);let r="palette-badge-success",n="palette-badge-danger",l="palette-badge-warning",i="palette-badge-neutral",o="palette-text-profit-strong",c="palette-text-loss-strong",d=e=>new Promise(t=>setTimeout(t,e)),m=({variant:e,children:s,className:a="",title:o})=>(0,t.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs border ${{success:r,danger:n,warning:l,neutral:i}[e]} ${a}`,title:o,children:s}),u=({children:e,className:s=""})=>{let a="table-wrap rounded-2xl border shadow-sm bg-white dark:bg-slate-900 dark:border-slate-700";return(0,t.jsx)("div",{className:s?a+" "+s:a,children:(0,t.jsx)("table",{className:"min-w-full text-sm text-gray-800 dark:text-slate-200 border-collapse",children:e})})},p=({className:e=""})=>(0,t.jsx)("div",{className:`animate-pulse bg-gray-200 dark:bg-slate-700 rounded ${e}`});function h(e,t){let s,a;return null==e?"-":0===e?"0.00":((a=(s=t&&["DOGE","ALGO","SHIB","PEPE","XRP","ADA","DOT","LINK","MATIC","AVAX"].some(e=>t.includes(e))?e.toFixed(4):e>=100?e.toFixed(2):e.toFixed(4)).split("."))[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join("."))}let x=new Map;function g(e,t,s,a="warn"){let r=Date.now();r-(x.get(e)??0)<3e4||(x.set(e,r),("warn"===a?console.warn:console.error)(t,s instanceof Error?{name:s.name,message:s.message,stack:s.stack}:s))}let f={Swing:{notificationProfile:"swing",rules:{Conservative:{rsi:{buyBelow:40,sellAbove:70},maChecks:{ema10:!0,ma50:!0,ma200:!0},sl:{atrMult:1.5},tp:{rr:1.5},volumeMinRatio:2,notes:["Operaciones multi-d√≠a","Confirmaci√≥n MA50/MA200"]},Aggressive:{rsi:{buyBelow:45,sellAbove:68},maChecks:{ema10:!0,ma50:!0,ma200:!0},sl:{atrMult:1},tp:{rr:1.2},volumeMinRatio:2,notes:["Entrada m√°s temprana","SL m√°s estrecho"]}}},Intraday:{notificationProfile:"intraday",rules:{Conservative:{rsi:{buyBelow:45,sellAbove:70},maChecks:{ema10:!0,ma50:!0,ma200:!1},sl:{atrMult:1},tp:{rr:1.2},volumeMinRatio:2,notes:["Cierra en el d√≠a","Evita overnight"]},Aggressive:{rsi:{buyBelow:50,sellAbove:65},maChecks:{ema10:!0,ma50:!0,ma200:!1},sl:{atrMult:.8},tp:{rr:1},volumeMinRatio:2,notes:["M√°s se√±ales","M√°s ruido"]}}},Scalp:{notificationProfile:"scalp",rules:{Conservative:{rsi:{buyBelow:50,sellAbove:70},maChecks:{ema10:!0,ma50:!1,ma200:!1},sl:{pct:.5},tp:{pct:.8},volumeMinRatio:2,notes:["Movimientos muy cortos","Slippage importa"]},Aggressive:{rsi:{buyBelow:55,sellAbove:65},maChecks:{ema10:!0,ma50:!1,ma200:!1},sl:{pct:.35},tp:{pct:.5},volumeMinRatio:2,notes:["Entradas anticipadas","Muchas micro-salidas"]}}}},b=[{version:"0.1",date:"2024-11-04",change:"Initial version history system implementation",details:"Created version history tab with expandable sections to document all changes and improvements systematically."},{version:"0.2",date:"2024-11-04",change:"Fixed port conflict between gluetun and backend",details:"Removed port 8002 from gluetun container port mappings. Backend now uses bridge network on port 8002 without conflicts."},{version:"0.3",date:"2024-11-04",change:"Updated frontend API URL configuration",details:"Changed frontend environment.ts and .env.local to use port 8002 instead of 8000 for backend API calls."},{version:"0.4",date:"2024-11-04",change:"Fixed frontend port mapping conflict",details:"Changed frontend port from 3000:3000 to 3001:3000 in docker-compose.yml to avoid conflict with gluetun."},{version:"0.5",date:"2024-11-04",change:"Optimized backend startup event",details:"Refactored startup event to run database initialization in thread pool executor to avoid blocking the event loop."},{version:"0.6",date:"2024-11-04",change:"Made service startup non-blocking",details:"Changed exchange_sync_service and signal_monitor_service to start in background tasks using asyncio.create_task() instead of await."},{version:"0.7",date:"2024-11-04",change:"Simplified health endpoint",details:"Removed VPN status checks from health endpoint to prevent blocking. Health endpoint now returns immediately."},{version:"0.8",date:"2024-11-04",change:"Adjusted Docker health check configuration",details:"Increased health check interval from 10s to 30s, timeout from 3s to 10s, and start_period from 20s to 60s to prevent restart loops."},{version:"0.9",date:"2024-11-04",change:"Removed blocking VPN gate check from startup",details:"Moved VPN gate monitor to background task to prevent blocking startup event."},{version:"0.10",date:"2024-11-04",change:"Fixed watchlist settings persistence on refresh",details:"Added useEffect hook to load all watchlist settings from localStorage on initial component mount to persist settings across page refreshes."},{version:"0.11",date:"2024-11-04",change:"Fixed margin status not saving",details:"Added localStorage.setItem() to margin toggle onClick handler to persist trade_on_margin status across refreshes."},{version:"0.12",date:"2024-11-04",change:"Fixed Telegram bot connectivity",details:"Removed backend from VPN network to allow Telegram API access. Added Telegram IP ranges to firewall outbound subnets."},{version:"0.13",date:"2024-11-04",change:"Fixed Telegram /start command",details:"Fixed message formatting (Markdown to HTML) and ensured scheduler starts correctly as async task."},{version:"0.14",date:"2024-11-04",change:"Updated Telegram /status command",details:"Updated /status command to show accurate data: active positions and tracked coins based on trade_enabled=True, individual trade amounts per coin, removed Paper Trading line."},{version:"0.15",date:"2024-11-04",change:"Fixed frontend network configuration",details:"Removed frontend from VPN network and changed port to 3001:3000 to allow direct access to backend on bridge network."},{version:"0.16",date:"2024-11-04",change:"Implemented /analyze command with coin selection menu",details:"Modified /analyze command to show a menu with all available coins for selection instead of requiring symbol as argument."},{version:"0.17",date:"2024-11-04",change:"Fixed backend startup blocking",details:"Made all background services start in fire-and-forget tasks to prevent blocking HTTP requests during startup."},{version:"0.18",date:"2024-11-04",change:"Fixed CORS preflight requests",details:"Explicitly enabled CORS middleware and configured it to allow all HTTP methods including OPTIONS requests."},{version:"0.19",date:"2024-11-04",change:"Fixed backend startup blocking issue",details:"Completely refactored startup event to be fully non-blocking. All background services now start in fire-and-forget tasks, allowing the server to respond to requests immediately after startup completes."},{version:"0.20",date:"2024-11-04",change:"Fixed watchlist, portfolio, and orders not loading",details:"Resolved backend API timeout issues that were preventing watchlist, portfolio, and order history from loading. Backend now responds immediately to all API requests after non-blocking startup completes."},{version:"0.21",date:"2024-11-04",change:"Fixed watchlist, portfolio, and orders not loading",details:"Resolved backend API timeout issues by making database dependencies non-blocking. Watchlist now loads 21 coins, portfolio shows 19 balances, and orders display 8 open orders correctly."},{version:"0.22",date:"2024-11-04",change:"Simplified root and health endpoints to avoid blocking",details:"Removed async/await and environment checks from root endpoint. Simplified health endpoint to return immediately without VPN status checks."},{version:"0.23",date:"2024-11-04",change:"Fixed indicators not loading in watchlist table",details:"Modified updateTopCoins function to extract technical indicators (RSI, ATR, MA50, MA200, EMA10) from coin objects returned by backend and populate the signals object. The table was reading indicators from signals but they were only present in the coin object, causing all indicators to show as empty."},{version:"0.24",date:"2024-11-04",change:"Fixed SL/TP calculation and resistance levels extraction",details:"Added res_up and res_down resistance levels to backend /market/top-coins-data endpoint and frontend TopCoin interface. Modified updateTopCoins to extract resistance levels from coin data. Fixed SL/TP calculation to work even when resistance levels are missing (uses fallback percentages). Ensured all coins are processed, not just those with complete indicator data."},{version:"0.25",date:"2024-11-04",change:"Fixed volume calculation in watchlist table",details:"Added avg_volume and volume_ratio to backend /market/top-coins-data endpoint from MarketData model. Modified frontend to use pre-calculated volume_ratio from backend when available, instead of incorrectly calculating from volume_24h. This ensures accurate volume ratio display in the watchlist table."},{version:"0.26",date:"2024-11-04",change:"Fixed alert status update timeout issue",details:"Added specific 10-second timeout for watchlist alert updates. Implemented optimistic UI updates with immediate localStorage persistence. Added fallback to saveCoinSettings if updateWatchlistAlert endpoint times out or fails. This ensures alert status updates are responsive and reliable even if the dedicated endpoint has issues."},{version:"0.27",date:"2024-11-04",change:"Increased timeout for top-coins-data endpoint",details:"Increased timeout for /market/top-coins-data endpoint from 30s to 60s to allow backend to return all coins. Added better logging for deleted coins filtering to help debug why only 2 coins are showing. This should allow all 21 coins from the backend to load properly."},{version:"0.28",date:"2024-11-04",change:"Optimized initial page load for faster startup",details:"Changed initial data loading from sequential to parallel. All endpoints (top coins, portfolio, orders, config) now load simultaneously instead of waiting for each other. Signal hydration now loads first batch immediately in parallel, then continues in background. This significantly reduces initial load time and ensures fresh data from backend tables is loaded immediately."},{version:"0.29",date:"2024-11-04",change:"Optimized backend database queries for faster response",details:"Optimized /market/top-coins-data endpoint to only query MarketData for symbols that have MarketPrice records, instead of querying all MarketData. This reduces database query time significantly. Improved logging to show query performance and warn if queries take longer than 0.5 seconds. This ensures backend responds faster to initial page load requests."},{version:"0.30",date:"2024-11-04",change:"Optimized portfolio and open orders endpoints for faster response",details:"Optimized get_portfolio_summary to use SQL aggregation (func.sum) for total_usd calculation instead of Python sum, reducing query time. Optimized open orders endpoint to limit results and add composite database index (status, create_time) for faster queries. Added performance logging to both endpoints to track query times and warn if they exceed 0.3 seconds. This significantly improves portfolio and open orders loading speed."},{version:"0.31",date:"2024-11-04",change:"Fixed /watchlist command in Telegram not showing coins with Trade=YES",details:"Fixed POST /dashboard endpoint to update existing watchlist items instead of raising error when item already exists. This ensures that when frontend saves trade_enabled=True, it updates the existing item in database instead of failing. Added debug logging to /watchlist command to help diagnose issues. Now when user changes Trade=YES in frontend, it correctly saves to database and Telegram /watchlist command will show the coins."},{version:"0.32",date:"2024-11-04",change:"Added detailed logging to debug trade_enabled save issue",details:"Added comprehensive logging to PUT /dashboard/{item_id} endpoint to log all received data, check if trade_enabled is present in request, and log the update process. This will help identify why trade_enabled is not being saved to database when user changes Trade=YES in frontend. Frontend now also logs the save process with try/catch to show any errors."}];function v(){return b[b.length-1].version}function y(){let e,r,n,l,i,x,b,y,[j,w]=(0,s.useState)("portfolio"),[N,S]=(0,s.useState)(!1),[k,C]=(0,s.useState)(!1),[$,A]=(0,s.useState)(null),[T,M]=(0,s.useState)([]),[E,P]=(0,s.useState)([]),[O,I]=(0,s.useState)(!0),[L,R]=(0,s.useState)(null),[F,U]=(0,s.useState)(null),[D,B]=(0,s.useState)(!0),[q,J]=(0,s.useState)(null),[V,Y]=(0,s.useState)(!0),[z,H]=(0,s.useState)(null),[K,W]=(0,s.useState)(!0),[Q,G]=(0,s.useState)(null),[X,Z]=(0,s.useState)(null),[ee,et]=(0,s.useState)([]),[es,ea]=(0,s.useState)([]),[er,en]=(0,s.useState)({symbol:"",status:"",side:""}),[el,ei]=(0,s.useState)({}),[eo,ec]=(0,s.useState)({}),[ed,em]=(0,s.useState)({}),[eu,ep]=(0,s.useState)({}),[eh,ex]=(0,s.useState)({}),[eg,ef]=(0,s.useState)({}),[eb,ev]=(0,s.useState)({}),[ey,e_]=(0,s.useState)({}),[ej,ew]=(0,s.useState)({}),[eN,eS]=(0,s.useState)(""),[ek,eC]=(0,s.useState)(null),[e$,eA]=(0,s.useState)({}),[eT,eM]=(0,s.useState)(!1),[eE,eP]=(0,s.useState)(!1),[eO,eI]=(0,s.useState)(null),[eL,eR]=(0,s.useState)(null),[eF,eU]=(0,s.useState)({}),[eD,eB]=(0,s.useState)("swing"),[eq,eJ]=(0,s.useState)({}),[eV,eY]=(0,s.useState)(null),[ez,eH]=(0,s.useState)(()=>f),[eK,eW]=(0,s.useState)("Swing"),[eQ,eG]=(0,s.useState)("Conservative"),eX=(0,s.useRef)([]),eZ=(0,s.useRef)({fastTimer:null,slowTimer:null,fastBackoffMs:15e3,fastPausedUntil:0,fastErrorCount:0,slowErrorCount:0,slowBackoffMs:6e4}),e0=(0,s.useRef)([]),e1=(0,s.useRef)([]),e2=(0,s.useRef)(null),[e4,e3]=(0,s.useState)(!1),e5=(0,s.useRef)(0),e6=(0,s.useCallback)(()=>{e5.current+=1,eP(!0)},[]),e7=(0,s.useCallback)(()=>{e5.current=Math.max(0,e5.current-1),0===e5.current&&eP(!1)},[]),e8=(0,s.useMemo)(()=>E.map(e=>e.instrument_name).filter(Boolean).sort().join("|"),[E]),e9=(0,s.useMemo)(()=>ee.filter(e=>{let t=!er.symbol||e.instrument_name.toLowerCase().includes(er.symbol.toLowerCase()),s=!er.status||e.status===er.status,a=!er.side||e.side===er.side;return t&&s&&a}),[ee,er]),te=(0,s.useMemo)(()=>es.filter(e=>{let t=!er.symbol||e.instrument_name.toLowerCase().includes(er.symbol.toLowerCase()),s=!er.status||e.status===er.status,a=!er.side||e.side===er.side;return t&&s&&a}),[es,er]);function tt(e,t,s){let a=ez[e]||f[e];if(!a)return`Preset "${e}" not found`;let r=a.rules[t];if(!r)return`Risk mode "${t}" not found for preset "${e}"`;let n=[`${e} \xb7 ${t}`,`RSI: buy<${r.rsi.buyBelow??"-"} / sell>${r.rsi.sellAbove??"-"}`],l=[];if(r.maChecks.ema10&&(void 0!==s.ema10?l.push(`EMA10=$${h(s.ema10)}`):l.push(`EMA10=‚úì`)),r.maChecks.ma50)if(void 0!==s.ma50&&void 0!==s.ema10){let e=s.ma50>s.ema10?"‚úì":"‚úó";l.push(`MA50=$${h(s.ma50)} ${e} MA50>EMA10`)}else void 0!==s.ma50?l.push(`MA50=$${h(s.ma50)}`):l.push(`MA50=‚úì`);if(r.maChecks.ma200)if(void 0!==s.ma200&&void 0!==s.currentPrice){let e=s.currentPrice>s.ma200?"‚úì":"‚úó";l.push(`MA200=$${h(s.ma200)} ${e} Price>MA200`)}else void 0!==s.ma200?l.push(`MA200=$${h(s.ma200)}`):l.push(`MA200=‚úì`);return l.length>0?n.push(`MAs: ${l.join(" | ")}`):n.push("MAs: no MA checks"),n.push(r.sl.atrMult?`SL‚âà price - ${r.sl.atrMult}\xd7ATR`:`SL‚âà -${r.sl.pct??"-"}%`,r.tp.rr?`TP‚âà price + ${r.tp.rr}\xd7(price-SL)`:`TP‚âà +${r.tp.pct??"-"}%`),r.notes?.length&&n.push(`Notas: ${r.notes.join(" ¬∑ ")}`),n.join("\n")}function ts(e,t,s,a){let r,n;if(!s)return{colorClass:"text-gray-400",tooltip:"Signal data not available"};let l=a[e.instrument_name]||"swing";if("swing"===l||"intraday"===l||"scalp"===l)r=l,n="Conservative";else if(l.includes("-conservative")){let e=l.replace("-conservative","");r=e.charAt(0).toUpperCase()+e.slice(1),n="Conservative"}else if(l.includes("-aggressive")){let e=l.replace("-aggressive","");r=e.charAt(0).toUpperCase()+e.slice(1),n="Aggressive"}else r="Swing",n="Conservative";let i=ez[r]?.rules[n]||f[r]?.rules[n],o=e.current_price,c=s.ma50,d=s.ema10,m=s.ma200,u=s.ma10w;switch(t){case"EMA10":if(void 0===d)return{colorClass:"text-gray-400",tooltip:"EMA10 data not available"};if(!o||0===o)return{colorClass:"text-gray-400",tooltip:`EMA10: $${h(d)} (precio no disponible)`};if(o>=d)return{colorClass:"palette-text-profit-strong text-green-600",tooltip:`üü¢ COMPRAR: Precio ($${h(o)}) ${o>d?">":"="} EMA10 ($${h(d)}). Tendencia alcista a corto plazo.`};return{colorClass:"palette-text-loss-strong text-red-600",tooltip:`üî¥ VENDER: Precio ($${h(o)}) < EMA10 ($${h(d)}). Tendencia bajista a corto plazo.`};case"MA50":if(void 0===c)return{colorClass:"text-gray-400",tooltip:"MA50 data not available"};if(i?.maChecks?.ma50&&void 0!==d)if(c>d)return{colorClass:"palette-text-profit-strong text-green-600",tooltip:`‚úÖ Criterio COMPRA cumplido: MA50 ($${h(c)}) > EMA10 ($${h(d)}). Condici\xf3n necesaria para se\xf1al BUY.`};else return{colorClass:"palette-text-loss-strong text-red-600",tooltip:`‚ùå Criterio COMPRA NO cumplido: MA50 ($${h(c)}) < EMA10 ($${h(d)}). Esta condici\xf3n bloquea se\xf1al BUY, sugiere SELL.`};if(!o||0===o)return{colorClass:"text-gray-400",tooltip:`MA50: $${h(c)} (precio no disponible)`};if(o>=c)return{colorClass:"text-gray-600",tooltip:`Precio ($${h(o)}) ${o>c?">":"="} MA50 ($${h(c)}). Tendencia alcista a medio plazo. (No usado en estrategia actual)`};return{colorClass:"text-gray-600",tooltip:`Precio ($${h(o)}) < MA50 ($${h(c)}). Tendencia bajista a medio plazo. (No usado en estrategia actual)`};case"MA200":if(void 0===m)return{colorClass:"text-gray-400",tooltip:"MA200 data not available"};let p=i?.maChecks?.ma200;if(!o||0===o)return{colorClass:"text-gray-400",tooltip:`MA200: $${h(m)} (precio no disponible)`};if(p)if(o>=m)return{colorClass:"palette-text-profit-strong text-green-600",tooltip:`‚úÖ Criterio COMPRA cumplido: Precio ($${h(o)}) ${o>m?">":"="} MA200 ($${h(m)}). Condici\xf3n necesaria para se\xf1al BUY. Este criterio NO es para vender - si est\xe1 verde, NO es raz\xf3n para SELL.`};else return{colorClass:"palette-text-loss-strong text-red-600",tooltip:`‚ùå Criterio COMPRA bloqueado: Precio ($${h(o)}) < MA200 ($${h(m)}). Esta condici\xf3n bloquea se\xf1al BUY. Si la se\xf1al es SELL, viene de otros criterios (RSI > sellAbove o MA50 < EMA10), NO de MA200.`};if(o>=m)return{colorClass:"text-gray-600",tooltip:`Precio ($${h(o)}) ${o>m?">":"="} MA200 ($${h(m)}). Tendencia alcista a largo plazo. (No usado en estrategia actual)`};return{colorClass:"text-gray-600",tooltip:`Precio ($${h(o)}) < MA200 ($${h(m)}). Tendencia bajista a largo plazo. (No usado en estrategia actual)`};case"MA10w":if(void 0===u)return{colorClass:"text-gray-400",tooltip:"MA10w data not available"};if(!o||0===o)return{colorClass:"text-gray-400",tooltip:`MA10w: $${h(u)} (precio no disponible)`};return{colorClass:"text-gray-600",tooltip:`MA10w: $${h(u)} | Precio: $${h(o)}. Este indicador NO se usa en la estrategia actual (solo se usan EMA10, MA50, MA200 seg\xfan preset). Mostrado solo como referencia informativa.`};default:return{colorClass:"text-gray-400",tooltip:"Unknown MA type"}}}let ta=(0,s.useCallback)((e,t)=>{let s;if(t&&t.length>0){let a=new Map(eX.current.map(e=>[e.instrument_name,e]));e.forEach(e=>{t.includes(e.instrument_name)&&a.set(e.instrument_name,e)}),eX.current=s=Array.from(a.values()),P(s);let r=new Date,n={};t.forEach(e=>{n[e]={price:r,signals:eF[e]?.signals||r}}),eU(e=>({...e,...n}))}else{s=e,eX.current=e,P(e);let t=new Date,a={};e.forEach(e=>{a[e.instrument_name]={price:t,signals:eF[e.instrument_name]?.signals||t}}),eU(e=>({...e,...a}))}let a=new Date;eA(e=>{let r={...e};return(t?s.filter(e=>t.includes(e.instrument_name)):s).forEach(e=>{let t=r[e.instrument_name]||{},s={...t,symbol:e.instrument_name,exchange:"CRYPTO_COM",price:e.current_price||t.price||0};void 0!==e.rsi&&(s.rsi=e.rsi),void 0!==e.atr&&(s.atr=e.atr),void 0!==e.ma50&&(s.ma50=e.ma50),void 0!==e.ma200&&(s.ma200=e.ma200),void 0!==e.ema10&&(s.ema10=e.ema10),void 0!==e.volume_24h&&(s.volume=e.volume_24h),void 0!==e.avg_volume&&(s.avg_volume=e.avg_volume),void 0!==e.volume_ratio&&(s.volume_ratio=e.volume_ratio),void 0!==e.res_up&&(s.res_up=e.res_up),void 0!==e.res_down&&(s.res_down=e.res_down),void 0===t.res_up&&e.res_up,void 0===t.res_down&&e.res_down,void 0!==t.ma10w&&(s.ma10w=t.ma10w),t.signals&&(s.signals=t.signals),r[e.instrument_name]=s,eU(t=>({...t,[e.instrument_name]:{price:t[e.instrument_name]?.price||a,signals:a}}))}),r})},[P,eF]),tr=(0,s.useCallback)((e,t)=>{if(!t||t<=0)return;let s=eX.current.map(s=>s.instrument_name===e?{...s,current_price:t}:s);s.some((e,t)=>e!==eX.current[t])&&ta(s)},[ta]),[tn,tl]=(0,s.useState)({rsiPeriod:14,rsiBuyThreshold:40,rsiSellThreshold:70,ma50Period:50,ema10Period:10,ma10wPeriod:70,atrPeriod:14,volumePeriod:10}),ti=(0,s.useCallback)(async e=>{if("USD"===e||"USDT"===e)return 1;if("EUR"===e)return 1.08;let t=E.find(t=>{let s=t.base_currency?.toUpperCase(),a=t.instrument_name?.split("_")[0]?.toUpperCase();return s===e.toUpperCase()||a===e.toUpperCase()});if(t?.current_price&&t.current_price>0)return t.current_price;let s=Object.keys(e$).find(t=>t.split("_")[0]?.toUpperCase()===e.toUpperCase());if(s){let e=e$[s];if(e?.price&&e.price>0)return e.price}return 0},[E,e$]),to=(0,s.useCallback)(async(e={})=>{let{showLoader:t=!1}=e;t&&B(!0);try{let e=await (0,a.getDashboardState)();if(e.bot_status&&("stopped"===e.bot_status.status&&"Status unavailable (checking...)"===e.bot_status.reason||Z(e.bot_status)),e.balances&&e.balances.length>0){M(e.balances);let t=[];if(e.balances&&e.balances.length>0&&e.balances.some(e=>{let t=void 0!==e.usd_value&&null!==e.usd_value&&e.usd_value>0,s=void 0!==e.market_value&&null!==e.market_value&&e.market_value>0;return t||s}),"portfolio_cache"===e.source||"crypto.com"===e.source||e.balances.length>0){for(let s of e.balances){let e=s.balance??s.total??s.free+s.locked;if(0===e&&0===s.free&&0===s.locked)continue;let a=void 0!==s.usd_value&&null!==s.usd_value&&s.usd_value>0?s.usd_value:void 0!==s.market_value&&null!==s.market_value&&s.market_value>0?s.market_value:0;t.push({coin:s.asset,balance:e,available_qty:s.free,reserved_qty:s.locked,haircut:0,value_usd:a,updated_at:new Date().toISOString()})}let s=t.reduce((e,t)=>e+t.value_usd,0),a=e.total_usd_value??s;t.filter(e=>e.value_usd>0).slice(0,10).forEach(e=>{}),[...t].sort((e,t)=>Math.abs(t.value_usd)-Math.abs(e.value_usd)).slice(0,10).forEach(e=>{}),A({assets:t,total_value_usd:a}),J(new Date),t.length>0&&0===t.filter(e=>e.value_usd>0).length&&(console.warn("‚ö†Ô∏è WARNING: Portfolio has balances but NO USD values found. Backend should calculate USD values on next sync."),console.warn("‚ö†Ô∏è This may happen if:"),console.warn("   - Market prices are not available"),console.warn("   - Backend cache has not been updated yet"),console.warn("   - Exchange sync service is not running")),setTimeout(()=>{t.filter(e=>e.value_usd>0).length>0||console.warn("‚ö†Ô∏è No assets with USD values found in portfolio - check backend logs")},100)}else{console.warn("‚ö†Ô∏è USD values not available from backend - backend should provide these values"),console.warn("‚ö†Ô∏è Source:",e.source),console.warn("‚ö†Ô∏è First balance sample:",e.balances[0]),console.warn("‚ö†Ô∏è Creating portfolio with balances but USD values = 0");let t=e.balances.filter(e=>(e.total??e.balance??(e.free??0)+(e.locked??0))>0).map(e=>{let t=e.balance??e.total??(e.free??0)+(e.locked??0);return{coin:e.asset,balance:t,available_qty:e.free??0,reserved_qty:e.locked??0,haircut:0,value_usd:e.usd_value??e.market_value??0,updated_at:new Date().toISOString()}}),s=t.reduce((e,t)=>e+t.value_usd,0),a=e.total_usd_value??s;A({assets:t,total_value_usd:a}),J(new Date)}}else{console.warn("‚ö†Ô∏è No balances in dashboardState, falling back to old endpoint");let e=await (0,a.getPortfolio)();A(e),J(new Date)}}catch(e){g("fetchPortfolio","Failed to fetch portfolio; attempting legacy fallback",e);try{let e=await (0,a.getPortfolio)();A(e),J(new Date)}catch(e){g("fetchPortfolio:fallback","Legacy portfolio fallback also failed",e)}}finally{B(!1)}},[ti]),tc=(0,s.useCallback)(e=>{let t=e?.current_price,s=e$[e?.instrument_name],a=el[e?.instrument_name+"_sl_tp"],r=eu[e?.instrument_name],n=eh[e?.instrument_name];if(!t||!s||!e?.instrument_name)return{sl:0,tp:0};let l=0,i=0;if(r&&""!==r){let e=parseFloat(r);isNaN(e)||(l=t*(1+e/100))}else l=a?s.res_down||.98*t:s.res_down||.97*t;if(n&&""!==n){let e=parseFloat(n);isNaN(e)||(i=t*(1+e/100))}else i=a?s.res_up||1.04*t:s.res_up||1.06*t;return{sl:l,tp:i}},[e$,el,eu,eh]),td=(0,s.useCallback)(e=>{let t=eZ.current;"fast"===e?(t.fastErrorCount=0,t.fastBackoffMs=15e3,t.fastPausedUntil=0,e2.current=null,e3(!1)):(t.slowErrorCount=0,t.slowBackoffMs=6e4)},[e3]),tm=(0,s.useCallback)((e,t)=>{let s=eZ.current;if("fast"===e){s.fastErrorCount+=1,e2.current=t??null;let e=t?.retryAfterMs??0;if(t?.status===429){let t=Math.min(24e4,Math.max(6e4,e||6e4));s.fastBackoffMs=t,s.fastPausedUntil=Date.now()+t,console.warn(`‚ö†Ô∏è Fast queue rate-limited. Backing off to ${t}ms`),e3(!0)}else if((t?.status??0)>=500||!t?.status){let e=Math.min(24e4,Math.max(15e3,2*s.fastBackoffMs));s.fastBackoffMs=e,s.fastPausedUntil=Date.now()+e,console.warn(`‚ö†Ô∏è Fast queue server error (${t?.status??"n/a"}). Backoff=${e}ms`)}else console.warn(`‚ö†Ô∏è Fast queue error without status`,t)}else{s.slowErrorCount+=1;let e=Math.min(24e4,Math.max(6e4,1.5*s.slowBackoffMs));s.slowBackoffMs=e,console.warn(`‚ö†Ô∏è Slow queue error (${t?.status??"n/a"}). Backoff=${e}ms`)}},[e3]),tu=(0,s.useCallback)(()=>{try{let e=localStorage.getItem("top_coins_cache");if(!e)return!1;let t=JSON.parse(e);if(t?.coins?.length){if(ta(t.coins),t.fetchedAt){let e=new Date(t.fetchedAt);Number.isNaN(e.valueOf())||U(e)}return R(null),I(!1),!0}}catch(e){console.warn("Failed to load cached top coins snapshot:",e)}return!1},[ta]),tp=(0,s.useCallback)(e=>{if(!e)return"‚Äî";let t=Date.now()-e.getTime();if(!Number.isFinite(t)||t<0)return"‚Äî";if(t<1e3)return"now";let s=Math.floor(t/1e3);if(s<60)return`${s}s`;let a=Math.floor(s/60);if(a<60)return`${a}m`;let r=Math.floor(a/60);if(r<24)return`${r}h`;let n=Math.floor(r/24);return`${n}d`},[]),th=(0,s.useCallback)(e=>{let t=eF[e];if(!t)return"Price: ‚Äî\nSignals: ‚Äî";let s=t.price?t.price.toLocaleString():"‚Äî",a=t.signals?t.signals.toLocaleString():"‚Äî";return`Price: ${s}
Signals: ${a}`},[eF]),tx=(0,s.useCallback)(async e=>{try{await new Promise(e=>setTimeout(e,500));let t=localStorage.getItem("signal_config"),s=t?JSON.parse(t):null,r=await (0,a.getTradingSignals)(e,s),n=r?{...r}:null,l=n?.price??0;if(!l||l<=0){let t=E.find(t=>t.instrument_name===e);t?.current_price&&t.current_price>0&&(l=t.current_price,n&&(n={...n,price:t.current_price}),tr(e,t.current_price))}else tr(e,l);eA(t=>({...t,[e]:n}));let i=new Date;eU(t=>({...t,[e]:{price:t[e]?.price||i,signals:i}}))}catch(t){if(t.message?.includes("Circuit breaker open")){t.retryAfterMs&&t.retryAfterMs;return}throw g(`fetchSignals:${e}`,`Failed to fetch signals for ${e}; will retry`,t),t}},[tr]),tg=(0,s.useCallback)(async()=>{let e=e0.current;if(!e.length)return;let t=tf.current||(()=>Promise.resolve());try{await t(!0,!0)}catch(e){console.warn("‚ö†Ô∏è Failed to fetch top coins (Trade YES) in fast tick:",e),U(new Date)}for(let t=0;t<e.length;t+=1){let s=e.slice(t,t+1),a=(await Promise.allSettled(s.map(e=>tx(e)))).find(e=>"rejected"===e.status);if(a)throw a.reason;t+1<e.length&&await d(1e3)}},[tx]),tf=(0,s.useRef)(null),tb=(0,s.useRef)(null),tv=(0,s.useRef)(null),ty=(0,s.useRef)(null),t_=(0,s.useRef)(null),tj=(0,s.useCallback)(async()=>{let e=tb.current||(()=>Promise.resolve()),t=tv.current||(()=>Promise.resolve()),s=ty.current||(()=>Promise.resolve()),a=tf.current||(()=>Promise.resolve()),r=t_.current||(()=>Promise.resolve());await Promise.allSettled([e(),t(),s()]);try{await a(!0,!1)}catch(e){console.warn("‚ö†Ô∏è Failed to fetch top coins (Trade NO) in slow tick:",e),U(new Date)}let n=e1.current;if(n.length)for(let e=0;e<n.length;e+=1){let t=n.slice(e,e+1),s=(await Promise.allSettled(t.map(e=>r(e)))).find(e=>"rejected"===e.status);if(s)throw s.reason;e+1<n.length&&await d(2e3)}},[]),tw=(0,s.useCallback)(e=>{let t=eZ.current;if(t.fastTimer&&(clearTimeout(t.fastTimer),t.fastTimer=null),0===e0.current.length)return;let s=Date.now(),a=e??t.fastBackoffMs;void 0===e&&(t.fastPausedUntil>s&&(a=Math.max(a,t.fastPausedUntil-s)),a=Math.max(15e3,a));let r=async()=>{e6();try{await tg(),td("fast")}catch(e){tm("fast",e)}finally{e7(),e0.current.length>0?tw():t.fastTimer=null}};t.fastTimer=setTimeout(r,a)},[tm,td,e7,e6,tg]),tN=(0,s.useCallback)(e=>{let t=eZ.current;t.slowTimer&&(clearTimeout(t.slowTimer),t.slowTimer=null);let s=e??t.slowBackoffMs;void 0===e&&(s=Math.max(6e4,s)),t.slowTimer=setTimeout(async()=>{e6();try{await tj(),td("slow")}catch(e){tm("slow",e)}finally{e7(),tN()}},s)},[tm,td,e7,e6,tj]);(0,s.useEffect)(()=>{let e=eZ.current,t=eX.current;if(0===t.length){e0.current=[],e1.current=[],e.fastTimer&&(clearTimeout(e.fastTimer),e.fastTimer=null),e.slowTimer||tN();return}let s=t.filter(e=>e.instrument_name&&!0===el[e.instrument_name]).map(e=>e.instrument_name),a=t.filter(e=>e.instrument_name&&!0!==el[e.instrument_name]).map(e=>e.instrument_name);s.length,a.length,s.slice().sort().join("|")!==e0.current.slice().sort().join("|")?(e0.current=s,0===s.length?e.fastTimer&&(clearTimeout(e.fastTimer),e.fastTimer=null):(e.fastBackoffMs=Math.max(15e3,Math.min(e.fastBackoffMs,24e4)),e.fastPausedUntil=0,tw(0))):s.length>0&&!e.fastTimer&&tw(15e3),a.slice().sort().join("|")!==e1.current.slice().sort().join("|")?(e1.current=a,e.slowTimer||tN()):!e.slowTimer&&t.length>0?tN():!e.slowTimer&&a.length>0&&tN()},[el,e8,tw,tN]),(0,s.useEffect)(()=>()=>{let e=eZ.current;e.fastTimer&&(clearTimeout(e.fastTimer),e.fastTimer=null),e.slowTimer&&(clearTimeout(e.slowTimer),e.slowTimer=null)},[]);let tS=(0,s.useCallback)(e=>{let t=new Set,s=e.filter(e=>{let s=e.instrument_name.toLowerCase();return!t.has(s)&&(t.add(s),!0)}),a=[];for(let e of s){let[t,s]=e.instrument_name.split("_");a.some(e=>{let[a,r]=e.instrument_name.split("_");return a===t&&(r===s||"USDT"===r&&"USD"===s||"USD"===r&&"USDT"===s)})||a.push(e)}return a},[]),tk=(0,s.useCallback)(async(e=!1,t)=>{e||I(!0);try{let s=(await (0,a.getTopCoins)()).coins||[];void 0!==t&&(s=s.filter(e=>{let s=!0===el[e.instrument_name];return t?s:!s}));try{let e=localStorage.getItem("deleted_coins");if(e){let t=JSON.parse(e),a=["BTC_USDT","BTC_USD","ETH_USDT","ETH_USD","BTC","ETH"],r=t.filter(e=>{let t=e.toUpperCase();return!a.some(e=>{let s=e.toUpperCase();return t===s||t.includes(s)})});r.length!==t.length&&(t.filter(e=>!r.includes(e)),0===r.length?localStorage.removeItem("deleted_coins"):localStorage.setItem("deleted_coins",JSON.stringify(r))),s.length;let n=new Set(a.map(e=>e.toUpperCase()));s=s.filter(e=>{let t=e.instrument_name.toUpperCase();return!!Array.from(n).some(e=>t===e||t.includes(e)||e.includes(t.split("_")[0]))||!r.some(e=>e.toUpperCase()===t)})}}catch(e){console.warn("Failed to check deleted coins:",e)}let r=tS(s);r.length;let n=void 0!==t?r.map(e=>e.instrument_name):void 0;ta(r,n);let l=new Date;try{localStorage.setItem("top_coins_cache",JSON.stringify({coins:r,fetchedAt:l.toISOString()}))}catch(e){console.warn("Failed to persist top coins snapshot:",e)}if(U(l),R(null),e)try{let e=localStorage.getItem("watchlist_amounts"),t=localStorage.getItem("watchlist_sl_percent"),s=localStorage.getItem("watchlist_tp_percent");if(e){let t=JSON.parse(e);em(e=>({...e,...t}))}if(t){let e=JSON.parse(t);ep(t=>({...t,...e}))}if(s){let e=JSON.parse(s);ex(t=>({...t,...e}))}}catch(e){console.warn("Failed to preserve watchlist values:",e)}if(!e){try{let e=localStorage.getItem("watchlist_amounts"),t=localStorage.getItem("watchlist_trade_status"),s=localStorage.getItem("watchlist_alert_status"),a=localStorage.getItem("watchlist_sl_percent"),r=localStorage.getItem("watchlist_tp_percent");e&&em(t=>({...t,...JSON.parse(e)})),t&&ei(e=>({...e,...JSON.parse(t)})),s&&ec(e=>({...e,...JSON.parse(s)})),a&&ep(e=>({...e,...JSON.parse(a)})),r&&ex(e=>({...e,...JSON.parse(r)}))}catch(e){console.warn("Failed to load from localStorage:",e)}try{let e=await (0,a.getDashboard)(),t={},s={},r={},n={},l={},i={},o={},c={},d={};if(e.forEach(e=>{e.symbol&&(void 0!==e.trade_amount_usd&&null!==e.trade_amount_usd&&(t[e.symbol]=e.trade_amount_usd.toString()),void 0!==e.trade_enabled&&null!==e.trade_enabled&&(s[e.symbol]=e.trade_enabled),void 0!==e.alert_enabled&&null!==e.alert_enabled&&(d[e.symbol]=e.alert_enabled),void 0!==e.trade_on_margin&&null!==e.trade_on_margin&&(r[e.symbol+"_margin"]=e.trade_on_margin),"aggressive"===e.sl_tp_mode&&(n[e.symbol+"_sl_tp"]=!0),void 0!==e.sl_percentage&&null!==e.sl_percentage&&(l[e.symbol]=e.sl_percentage.toString()),void 0!==e.tp_percentage&&null!==e.tp_percentage&&(i[e.symbol]=e.tp_percentage.toString()),void 0!==e.sl_price&&null!==e.sl_price&&(o[e.symbol]=e.sl_price),void 0!==e.tp_price&&null!==e.tp_price&&(c[e.symbol]=e.tp_price))}),Object.keys(t).length>0||Object.keys(s).length>0||Object.keys(r).length>0||Object.keys(l).length>0||Object.keys(i).length>0||Object.keys(d).length>0||e.length>0){Object.keys(t).length>0&&em(e=>({...e,...t})),Object.keys(l).length>0&&ep(e=>({...e,...l})),Object.keys(i).length>0&&ex(e=>({...e,...i})),(Object.keys(s).length>0||Object.keys(r).length>0||Object.keys(n).length>0)&&ei(e=>({...e,...s,...r,...n})),Object.keys(d).length>0&&ec(e=>({...e,...d})),Object.keys(o).length>0&&ef(o),Object.keys(c).length>0&&ev(c);try{let e=localStorage.getItem("watchlist_amounts"),a=e?JSON.parse(e):{},o={...t,...a};localStorage.setItem("watchlist_amounts",JSON.stringify(o));let c=localStorage.getItem("watchlist_sl_percent"),m=c?JSON.parse(c):{},u={...l,...m};localStorage.setItem("watchlist_sl_percent",JSON.stringify(u));let p=localStorage.getItem("watchlist_tp_percent"),h=p?JSON.parse(p):{},x={...i,...h};localStorage.setItem("watchlist_tp_percent",JSON.stringify(x));let g=localStorage.getItem("watchlist_trade_status"),f=g?JSON.parse(g):{},b={...s,...r,...n,...f};if(localStorage.setItem("watchlist_trade_status",JSON.stringify(b)),Object.keys(d).length>0){let e=localStorage.getItem("watchlist_alert_status"),t=e?JSON.parse(e):{},s={...d,...t};localStorage.setItem("watchlist_alert_status",JSON.stringify(s))}}catch(e){console.warn("Failed to merge localStorage values:",e),localStorage.setItem("watchlist_amounts",JSON.stringify(t)),localStorage.setItem("watchlist_sl_percent",JSON.stringify(l)),localStorage.setItem("watchlist_tp_percent",JSON.stringify(i)),localStorage.setItem("watchlist_trade_status",JSON.stringify({...s,...r,...n})),Object.keys(d).length>0&&localStorage.setItem("watchlist_alert_status",JSON.stringify(d))}}}catch(e){console.warn("Failed to load from backend, using localStorage:",e)}}}catch(s){g("fetchTopCoins","Failed to fetch top coins; using cached data if available",s);let e=s instanceof Error?s.message:"Unknown error";R(e);let t=new Date;U(t),console.warn(`‚ö†Ô∏è fetchTopCoins failed at ${t.toISOString()}: ${e}`),tu()||0!==eX.current.length||console.warn("‚ö†Ô∏è No cached coins available and fetch failed - watchlist will be empty");return}finally{e||I(!1)}},[ta,tS,tu]),tC=(0,s.useCallback)(async(e={})=>{let{showLoader:t=!1}=e;t&&Y(!0);try{let e=await (0,a.getDashboardState)();if(e.open_orders&&e.open_orders.length>0){let t=e.open_orders.map(e=>{let t=e.created_at?new Date(e.created_at).getTime():Date.now(),s=e.updated_at?new Date(e.updated_at).getTime():Date.now();return{order_id:e.exchange_order_id,instrument_name:e.symbol,side:e.side||"UNKNOWN",order_type:e.order_type||"LIMIT",quantity:e.quantity?.toString()||"0",price:e.price?.toString()||"0",status:e.status||"UNKNOWN",create_time:t,update_time:s}});et(t),H(new Date)}else{try{let e=await (0,a.getOpenOrders)();et(e.orders||[])}catch(e){g("fetchOpenOrders:fallback","Legacy open orders fallback failed; clearing list",e),et([])}H(new Date)}}catch(e){g("fetchOpenOrders","Failed to fetch open orders; attempting legacy endpoint",e);try{let e=await (0,a.getOpenOrders)();et(e.orders||[]),H(new Date)}catch(e){g("fetchOpenOrders:fallback","Legacy open orders fallback failed; clearing list",e),et([])}}finally{Y(!1)}},[]),t$=(0,s.useCallback)(async(e={})=>{let{showLoader:t=!1,limit:s=100,offset:r=0}=e;t&&W(!0);try{let e=(await (0,a.getOrderHistory)(s,r)).orders||[];ea(t=>{let s=new Set(t.map(e=>e.order_id)),a=e.filter(e=>!s.has(e.order_id));return a.length>0?(G(new Date),[...a,...t]):(G(new Date),t)})}catch(e){g("fetchExecutedOrders","Failed to fetch executed orders (request will retry on next tick)",e)}finally{W(!1)}},[]),tA=(0,s.useCallback)(async()=>{try{let e=await (0,a.getDataSourcesStatus)();eI(e)}catch(e){g("fetchDataSourceStatus","Failed to fetch data source status; will retry on next refresh",e)}},[]),tT=(0,s.useCallback)(async()=>{try{let e=await (0,a.getTradingConfig)();if(eR(e),e?.coins){let t={};Object.entries(e.coins).forEach(([e,s])=>{s?.preset&&(t[e]=s.preset)}),eJ(t)}}catch(e){g("fetchTradingConfig","Failed to fetch trading config; using cached values",e)}},[]);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("watchlist_amounts"),t=localStorage.getItem("watchlist_trade_status"),s=localStorage.getItem("watchlist_alert_status"),a=localStorage.getItem("watchlist_sl_percent"),r=localStorage.getItem("watchlist_tp_percent");if(e){let t=JSON.parse(e);em(t)}if(t){let e=JSON.parse(t);ei(e)}if(s){let e=JSON.parse(s);ec(e)}if(a){let e=JSON.parse(a);ep(e)}if(r){let e=JSON.parse(r);ex(e)}}catch(e){console.warn("Failed to load watchlist settings from localStorage on mount:",e)}},[]),(0,s.useEffect)(()=>{tf.current=tk,tb.current=to,tv.current=tC,ty.current=t$,t_.current=tx},[tk,to,tC,t$,tx]);let tM=async(e,t)=>{let s,r;if(eJ(s=>({...s,[e]:t})),"swing"===t||"intraday"===t||"scalp"===t)s=t,r="Conservative";else if(t.includes("-conservative")){let e=t.replace("-conservative","");s=e.charAt(0).toUpperCase()+e.slice(1),r="Conservative"}else if(t.includes("-aggressive")){let e=t.replace("-aggressive","");s=e.charAt(0).toUpperCase()+e.slice(1),r="Aggressive"}else s="Swing",r="Conservative";let n="Aggressive"===r;ei(t=>({...t,[e+"_sl_tp"]:n}));let l=E.find(t=>t.instrument_name===e),i=e$[e],o=ez[s]||f[s];if(l&&i&&o){let t=o.rules[r],{slPrice:s,tpPrice:c}=function({price:e,atr:t,rules:s}){let a,r;return s.sl.atrMult&&t?a=e-s.sl.atrMult*t:s.sl.pct&&(a=e*(1-s.sl.pct/100)),s.tp.rr&&null!=a?r=e+s.tp.rr*(e-a):s.tp.pct&&(r=e*(1+s.tp.pct/100)),{slPrice:a,tpPrice:r}}({price:l.current_price,atr:i.atr,rules:t});s&&ef(t=>({...t,[e]:s})),c&&ev(t=>({...t,[e]:c}));try{let t={sl_tp_mode:n?"aggressive":"conservative"};s&&(t.sl_price=s),c&&(t.tp_price=c),await (0,a.saveCoinSettings)(e,t)}catch(t){console.warn(`‚ö†Ô∏è Failed to save strategy settings for ${e}:`,t)}}},tE=async()=>{let e=eN.trim().toUpperCase();if(!e)return void alert("Please enter a symbol");if(eX.current.some(t=>t.instrument_name===e))return void alert("This symbol already exists in the watchlist");try{S(!0);let t=e.split("_");if(2!==t.length||!t[0]||!t[1]){alert("Symbol must be in the format BASE_QUOTE (e.g., BTC_USDT)"),S(!1);return}let[s,r]=t;s.toLowerCase(),r.toLowerCase();let n=eX.current.map(e=>e.instrument_name.toLowerCase()).find(t=>t===e.toLowerCase());if(n){alert(`This coin (${n.toUpperCase()}) already exists. Please choose a different symbol.`),S(!1);return}let l=s.toUpperCase(),i=r.toUpperCase();try{await (0,a.addCustomTopCoin)({instrument_name:e,base_currency:l,quote_currency:i})}catch(t){console.error("Failed to add custom top coin:",t);let e=t instanceof Error?t.message:"Unknown error";e.includes("401")||e.includes("403")||t?.status===401||t?.status===403?alert("Authentication failed. Please check if you are logged in."):e.includes("timeout")?alert("Request timeout. The server may be processing the request. Please try again."):alert(`Failed to add symbol: ${e}`),S(!1);return}let o={rank:eX.current.length+1,instrument_name:e,base_currency:l,quote_currency:i,current_price:0,volume_24h:0,updated_at:new Date().toISOString(),is_custom:!0};ta([...eX.current,o]);try{let t=localStorage.getItem("deleted_coins");if(t){let s=JSON.parse(t);if(s.includes(e)){let t=s.filter(t=>t!==e);localStorage.setItem("deleted_coins",JSON.stringify(t))}}}catch(e){console.warn("Failed to update deleted coins cache:",e)}eS(""),C(!1);try{await (0,a.saveCoinSettings)(e,{})}catch(e){console.warn("Could not save to backend, but symbol added locally:",e)}await tk(!0)}catch(e){g("handleAddSymbol","Failed to add symbol",e,"error"),alert("Failed to add symbol. Please try again.")}finally{S(!1)}},tP=async e=>{if(ek===e){let t=eX.current.find(t=>t.instrument_name===e);if(ta(eX.current.filter(t=>t.instrument_name!==e)),t?.is_custom)try{await (0,a.removeCustomTopCoin)(e)}catch(t){console.warn(`Failed to remove custom coin ${e} from backend:`,t)}if(!t?.is_custom){if(["BTC_USDT","BTC_USD","ETH_USDT","ETH_USD","BTC","ETH"].some(t=>e.toUpperCase().includes(t)))return void alert(`Cannot delete ${e}: This is a protected major coin (BTC/ETH) that cannot be permanently hidden.`);try{let t=localStorage.getItem("deleted_coins"),s=t?JSON.parse(t):[];s.includes(e)||(s.push(e),localStorage.setItem("deleted_coins",JSON.stringify(s)))}catch(e){console.warn("Failed to save deleted coin:",e)}}let s={...ed},r={...eu},n={...eh},l={...el};if(delete s[e],delete r[e],delete n[e],delete l[e],delete l[e+"_margin"],delete l[e+"_sl_tp"],em(s),ep(r),ex(n),ei(l),localStorage.setItem("watchlist_amounts",JSON.stringify(s)),localStorage.setItem("watchlist_sl_percent",JSON.stringify(r)),localStorage.setItem("watchlist_tp_percent",JSON.stringify(n)),eC(null),t?.is_custom)try{await tk(!0)}catch(e){tm("slow",e)}}else eC(e)},tO=(0,s.useRef)(null);return(0,s.useEffect)(()=>{tO.current=tu},[tu]),(0,s.useEffect)(()=>{let e=!0,t=!1;return(async()=>{if(t)return;t=!0;let s=localStorage.getItem("strategy_presets_config");if(s)try{let e=JSON.parse(s);eH(e)}catch(e){g("loadSavedPresetsConfig","Failed to parse saved presets config; ignoring cached value",e)}tO.current?.();let a=tf.current||(()=>Promise.resolve()),r=tb.current||(()=>Promise.resolve()),n=tv.current||(()=>Promise.resolve()),l=ty.current||(()=>Promise.resolve()),i=t_.current||(()=>Promise.resolve());Date.now();let[o,c,m,u,p,h]=await Promise.allSettled([a(!1).then(()=>{td("slow")}).catch(t=>{throw e&&(tm("slow",t),g("initialTopCoinsFetch","Initial top coins fetch failed",t)),t}),r().then(()=>console.log("‚úÖ Portfolio fetched from backend")),n().then(()=>console.log("‚úÖ Open orders fetched from backend")),l().then(()=>console.log("‚úÖ Executed orders fetched from backend")),tA().then(()=>console.log("‚úÖ Data source status fetched from backend")),tT().then(()=>console.log("‚úÖ Trading config fetched from backend"))]);Date.now();let x=[o,c,m,u,p,h].filter(e=>"rejected"===e.status);x.length>0&&(console.warn(`‚ö†Ô∏è ${x.length}/6 initial data fetches failed`),x.forEach(e=>console.warn("Failed fetch:",e.reason))),(async()=>{let t=eX.current;if(!e||0===t.length)return;let s=t.filter(e=>e.instrument_name&&!0===el[e.instrument_name]).map(e=>e.instrument_name),a=t.filter(e=>e.instrument_name&&!0!==el[e.instrument_name]).map(e=>e.instrument_name),r=async(t,s,a)=>{let r=t.slice(0,Math.min(3*s,t.length)),n=t.slice(r.length);if(r.length>0){let e=(await Promise.allSettled(r.map(e=>i(e)))).filter(e=>"rejected"===e.status);e.length>0&&console.warn(`‚ö†Ô∏è ${e.length}/${r.length} signals failed in immediate batch for ${a} queue`)}n.length>0&&e&&(async()=>{for(let t=0;t<n.length&&e;t+=s){let e=n.slice(t,t+s),r=(await Promise.allSettled(e.map(e=>i(e)))).filter(e=>"rejected"===e.status);r.length>0&&console.warn(`‚ö†Ô∏è ${r.length}/${e.length} signals failed in background batch ${t}-${t+s} for ${a} queue`),t+s<n.length&&await d(1e3)}})()};s.length&&await r(s,1,"fast"),a.length&&await r(a.slice(0,Math.min(4,a.length)),1,"slow")})().catch(e=>g("initialSignalHydration","Initial signal hydration failed",e))})(),()=>{e=!1}},[]),(0,s.useEffect)(()=>{let e=Object.entries(el).filter(([e,t])=>t&&!e.includes("_margin")&&!e.includes("_sl_tp")).map(([e])=>e);e.length>0&&e.forEach(e=>{tx(e).catch(e=>tm("fast",e))})},[el,tx,tm]),(0,s.useEffect)(()=>{let e=eX.current.filter(e=>e.instrument_name&&!e$[e.instrument_name]);if(e.length>0){let t=setTimeout(()=>{e.forEach(e=>{e.instrument_name&&tx(e.instrument_name).catch(e=>tm("slow",e))})},5e3);return()=>clearTimeout(t)}},[E.length,tx,tm,e$]),(0,s.useEffect)(()=>{let e=()=>{eX.current.forEach(e=>{if(!0!==el[e.instrument_name])return;let t=void 0!==eg[e.instrument_name]&&0!==eg[e.instrument_name],s=void 0!==eb[e.instrument_name]&&0!==eb[e.instrument_name],r=e$[e.instrument_name];if((!t||!s)&&r){let t=tc(e);t.sl>0&&t.tp>0&&(ef(s=>({...s,[e.instrument_name]:t.sl})),ev(s=>({...s,[e.instrument_name]:t.tp})),(async()=>{try{let s={sl_price:t.sl,tp_price:t.tp};await (0,a.saveCoinSettings)(e.instrument_name,s)}catch(t){console.warn(`‚ö†Ô∏è Failed to save calculated SL/TP prices for ${e.instrument_name}:`,t)}})())}})};e();let t=setInterval(e,3e3);return()=>clearInterval(t)},[tc,eg,eb,e$]),(0,s.useEffect)(()=>{Object.keys(e$).length>0&&eX.current.forEach(e=>{if(!0!==el[e.instrument_name])return;let t=void 0!==eg[e.instrument_name]&&0!==eg[e.instrument_name],s=void 0!==eb[e.instrument_name]&&0!==eb[e.instrument_name],r=e$[e.instrument_name]&&e$[e.instrument_name]?.res_up&&e$[e.instrument_name]?.res_down;if((!t||!s)&&r){let t=tc(e);t.sl>0&&t.tp>0&&(ef(s=>({...s,[e.instrument_name]:t.sl})),ev(s=>({...s,[e.instrument_name]:t.tp})),(async()=>{try{let s={sl_price:t.sl,tp_price:t.tp};await (0,a.saveCoinSettings)(e.instrument_name,s)}catch(t){console.warn(`‚ö†Ô∏è Failed to save calculated SL/TP prices for ${e.instrument_name}:`,t)}})())}})},[e$,tc,eg,eb,el]),(0,s.useEffect)(()=>{eX.current.length>0&&eX.current.forEach(e=>{if(!0!==el[e.instrument_name])return;let t=void 0!==eg[e.instrument_name]&&0!==eg[e.instrument_name],s=void 0!==eb[e.instrument_name]&&0!==eb[e.instrument_name];if(!t||!s){let t=e$[e?.instrument_name];if(t&&t.res_up&&t.res_down){let t=tc(e);t.sl>0&&t.tp>0&&(ef(s=>({...s,[e.instrument_name]:t.sl})),ev(s=>({...s,[e.instrument_name]:t.tp})))}}})},[eX.current.length,e$,tc,eg,eb,el]),(0,t.jsxs)("div",{className:"container mx-auto p-8",children:[(0,t.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Trading Dashboard"})}),(0,t.jsxs)("div",{className:"flex gap-2 mb-6 border-b",children:[(0,t.jsxs)("button",{onClick:()=>w("portfolio"),className:`px-4 py-2 font-medium flex items-center gap-2 ${"portfolio"===j?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[(0,t.jsx)("span",{children:"Portfolio"}),(0,t.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded",children:["v",v()]})]}),(0,t.jsxs)("button",{onClick:()=>w("watchlist"),className:`px-4 py-2 font-medium flex items-center gap-2 ${"watchlist"===j?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[(0,t.jsx)("span",{children:"Watchlist"}),(0,t.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded",children:["v",v()]})]}),(0,t.jsxs)("button",{onClick:()=>w("orders"),className:`px-4 py-2 font-medium flex items-center gap-2 ${"orders"===j?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[(0,t.jsx)("span",{children:"Open Orders"}),(0,t.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded",children:["v",v()]})]}),(0,t.jsxs)("button",{onClick:()=>w("executed-orders"),className:`px-4 py-2 font-medium flex items-center gap-2 ${"executed-orders"===j?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[(0,t.jsx)("span",{children:"Executed Orders"}),(0,t.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded",children:["v",v()]})]}),(0,t.jsxs)("button",{onClick:()=>w("version-history"),className:`px-4 py-2 font-medium flex items-center gap-2 ${"version-history"===j?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[(0,t.jsx)("span",{children:"Version History"}),(0,t.jsxs)("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded",children:["v",v()]})]})]}),"portfolio"===j&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[q&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,t.jsx)("span",{className:"mr-2",children:"üïê"}),"√öltima actualizaci√≥n: ",q.toLocaleString()]}),X&&(0,t.jsx)("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${X.is_running?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,title:X.reason||void 0,children:X.is_running?"üü¢ Bot Activo":"üî¥ Bot Detenido"})]}),D?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6 shadow-lg",children:[(0,t.jsx)(p,{className:"h-5 w-36 mb-4 bg-white/40"}),(0,t.jsx)(p,{className:"h-10 w-48 bg-white/60"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Holdings"}),(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{className:"sticky top-0 z-10",children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Coin"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Balance"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Reserved"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"USD Value"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"% Portfolio"})]})}),(0,t.jsx)("tbody",{children:Array.from({length:5}).map((e,s)=>(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-24"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-24 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})})]},`portfolio-skeleton-${s}`))})]})]})]}):$&&$.assets.length>0||T.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6 mb-6 shadow-lg",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Portfolio Value"}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:["$",h($?.total_value_usd??T.reduce((e,t)=>e+(t.usd_value??t.market_value??0),0))]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm opacity-90",children:"Crypto.com Exchange"}),(0,t.jsxs)("p",{className:"text-sm opacity-75",children:[T.length>0?T.filter(e=>(e.total??e.balance??(e.free??0)+(e.locked??0))>0).length:$?.assets.length??0," assets"]})]})]})}),(e=T.length>0,r=$&&$.assets.length>0,n=e?T:[],l=r?$.assets:[],(n.length>0&&n.some(e=>(e.total??e.balance??(e.free??0)+(e.locked??0))>0)||l.length>0&&l.some(e=>(e.balance??e.available_qty+e.reserved_qty)>0))&&(n.length>0&&!n.some(e=>(e.usd_value??e.market_value??0)>0)||l.length>0&&!l.some(e=>(e.value_usd??0)>0))?(0,t.jsx)("div",{className:"mb-4 text-sm text-orange-700 bg-orange-50 border border-orange-200 rounded px-3 py-2",children:"‚ö†Ô∏è Balances found but USD values not calculated yet. Backend will calculate USD values on next sync."}):null),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Holdings"}),(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{className:"sticky top-0 z-10",children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Coin"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Balance"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Reserved"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"USD Value"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"% Portfolio"})]})}),(0,t.jsx)("tbody",{children:T.length>0?(i=T.filter(e=>(e.total??e.balance??(e.free??0)+(e.locked??0))>0)).length>0?i.map(e=>{let t=$?.assets?.find(t=>t.coin===e.asset),s=void 0!==e.usd_value&&null!==e.usd_value&&e.usd_value>0?e.usd_value:void 0!==e.market_value&&null!==e.market_value&&e.market_value>0?e.market_value:t?.value_usd??0,a=$?.total_value_usd??T.reduce((e,t)=>e+(t.usd_value??t.market_value??0),0),r=a>0&&s>0?h(s/a*100):"0.00";return{balance:e,displayValueUsd:s,percentOfPortfolio:r}}).sort((e,t)=>t.displayValueUsd-e.displayValueUsd).map(({balance:e,displayValueUsd:s,percentOfPortfolio:a})=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium",children:e.asset}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(e.balance??e.total??(e.free??0)+(e.locked??0),e.asset)}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(e.locked??0,e.asset)}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right font-semibold",children:["$",h(s)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right",children:[a,"%"]})]},e.asset)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-500",children:"No balances with positive amounts found in realBalances. Showing portfolio.assets instead."})}):$&&$.assets.length>0?(x=$.assets.filter(e=>(e.balance??e.available_qty+e.reserved_qty)>0),b=$.total_value_usd??x.reduce((e,t)=>e+(t.value_usd??0),0),x.length>0?x.sort((e,t)=>(t.value_usd??0)-(e.value_usd??0)).map(e=>{let s=b>0&&(e.value_usd??0)>0?h((e.value_usd||0)/b*100):"0.00";return(0,t.jsxs)("tr",{className:"hover:bg-gray-50 border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium",children:e.coin}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(e.balance??e.available_qty+e.reserved_qty,e.coin)}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(e.reserved_qty??0,e.coin)}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right font-semibold",children:["$",h(e.value_usd||0)]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right",children:[s,"%"]})]},e.coin)}):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-500",children:"No portfolio assets with positive balances found."})})):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-500",children:"No portfolio data available. Please wait for data to load or check backend connection."})})})]})]})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)("p",{children:"No portfolio data available."}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Upload a CSV file via the API to import your assets."})]})]}),"watchlist"===j&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Watchlist"}),F&&(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["üïê ",F.toLocaleString()]}),X&&(0,t.jsx)("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${X.is_running?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,title:X.reason||void 0,children:X.is_running?"üü¢ Bot Activo":"üî¥ Bot Detenido"}),eE&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,t.jsx)("span",{children:"Updating..."})]}),e4&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-orange-600",children:[(0,t.jsx)("span",{className:"inline-flex h-2 w-2 rounded-full bg-orange-500 animate-pulse"}),(0,t.jsx)("span",{children:"Rate limited ¬∑ slowing cadence"})]}),eO&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Data:"}),Object.entries(eO).map(([e,s])=>(0,t.jsx)("span",{className:`px-2 py-1 rounded ${s.available?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,title:`${e}: ${s.available?"Available":"Unavailable"} (${s.response_time?.toFixed(2)}s)`,children:e},e))]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>eM(!eT),className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:eT?"Close Config":"‚öôÔ∏è Signal Config"}),(0,t.jsx)("button",{onClick:()=>C(!k),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:k?"Cancel":"+ Add Symbol"})]})]}),L&&(0,t.jsx)("div",{className:"mb-4 text-sm text-orange-700 bg-orange-50 border border-orange-200 rounded px-3 py-2",children:E.length>0?(0,t.jsxs)(t.Fragment,{children:["Refresh failed (",L,"). Showing cached data",F?` from ${F.toLocaleString()}`:"",". Retrying automatically."]}):(0,t.jsxs)(t.Fragment,{children:["Unable to load watchlist data (",L,"). Retrying automatically‚Ä¶"]})}),eT&&(0,t.jsxs)("div",{className:"bg-purple-50 border-2 border-purple-300 rounded-lg p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-purple-900",children:"üìä Strategy Presets Configuration"}),(0,t.jsx)("button",{onClick:()=>{let e=localStorage.getItem("strategy_presets_config");if(e)try{let t=JSON.parse(e);eH(t)}catch(e){g("loadSavedPresetConfigManual","Failed to parse saved preset config; changes not applied",e)}},className:"text-sm bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700",children:"üì• Load Saved"})]}),(0,t.jsx)("div",{className:"mb-4 flex flex-wrap gap-2 border-b-2 border-purple-300 pb-2",children:["Swing","Intraday","Scalp"].map(e=>["Conservative","Aggressive"].map(s=>{let a=`${e}-${s}`,r=eK===e&&eQ===s;return(0,t.jsxs)("button",{onClick:()=>{eW(e),eG(s)},className:`px-4 py-2 rounded font-medium transition-colors ${r?"bg-purple-600 text-white":"bg-purple-100 text-purple-800 hover:bg-purple-200"}`,children:[e," ",s]},a)}))}),(y=ez[eK]?.rules[eQ])?(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-purple-200",children:[(0,t.jsxs)("h4",{className:"text-lg font-semibold mb-4 text-purple-800",children:[eK," - ",eQ]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-semibold mb-3 text-purple-700",children:"üìà RSI Parameters"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"rsi-buy-below",className:"block text-sm font-medium mb-2",children:"RSI Buy Below"}),(0,t.jsx)("input",{id:"rsi-buy-below",type:"number",placeholder:"40",title:"RSI Buy Below threshold",value:y.rsi?.buyBelow??40,onChange:e=>{let t=parseInt(e.target.value)||40;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],rsi:{...y.rsi,buyBelow:t}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",min:"0",max:"100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"rsi-sell-above",className:"block text-sm font-medium mb-2",children:"RSI Sell Above"}),(0,t.jsx)("input",{id:"rsi-sell-above",type:"number",placeholder:"70",title:"RSI Sell Above threshold",value:y.rsi?.sellAbove??70,onChange:e=>{let t=parseInt(e.target.value)||70;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],rsi:{...y.rsi,sellAbove:t}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",min:"0",max:"100"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-semibold mb-3 text-purple-700",children:"üìä Moving Averages"}),(0,t.jsx)("div",{className:"space-y-2",children:["ema10","ma50","ma200"].map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:y.maChecks?.[e]??!1,onChange:t=>{eH(s=>({...s,[eK]:{...s[eK],rules:{...s[eK].rules,[eQ]:{...s[eK].rules[eQ],maChecks:{...y.maChecks,[e]:t.target.checked}}}}}))},className:"w-4 h-4 text-purple-600",title:`Toggle ${e.toUpperCase()} check`,"aria-label":`${e.toUpperCase()} check`}),(0,t.jsx)("span",{className:"text-sm font-medium",children:e.toUpperCase()})]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-semibold mb-3 text-purple-700",children:"üõ°Ô∏è Stop Loss & Take Profit"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"sl-method",className:"block text-sm font-medium mb-2",children:"SL Method"}),(0,t.jsxs)("select",{id:"sl-method",title:"Stop Loss calculation method",value:y.sl?.atrMult!==void 0?"atr":"pct",onChange:e=>{let t=e.target.value;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],sl:"atr"===t?{atrMult:y.sl?.atrMult??1.5}:{pct:y.sl?.pct??.5}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"atr",children:"ATR Multiplier"}),(0,t.jsx)("option",{value:"pct",children:"Percentage"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"sl-value",className:"block text-sm font-medium mb-2",children:y.sl?.atrMult!==void 0?"ATR Multiplier":"Percentage (%)"}),(0,t.jsx)("input",{id:"sl-value",type:"number",step:"0.1",placeholder:y.sl?.atrMult!==void 0?"1.5":"0.5",title:y.sl?.atrMult!==void 0?"ATR Multiplier value":"Stop Loss Percentage",value:y.sl?.atrMult??y.sl?.pct??1.5,onChange:e=>{let t=parseFloat(e.target.value)||1.5;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],sl:y.sl?.atrMult!==void 0?{atrMult:t}:{pct:t}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",min:"0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"tp-method",className:"block text-sm font-medium mb-2",children:"TP Method"}),(0,t.jsxs)("select",{id:"tp-method",title:"Take Profit calculation method",value:y.tp?.rr!==void 0?"rr":"pct",onChange:e=>{let t=e.target.value;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],tp:"rr"===t?{rr:y.tp?.rr??1.5}:{pct:y.tp?.pct??.8}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"rr",children:"Risk:Reward Ratio"}),(0,t.jsx)("option",{value:"pct",children:"Percentage"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:y.tp?.rr!==void 0?"Risk:Reward Ratio":"Percentage (%)"}),(0,t.jsx)("input",{id:"tp-value",type:"number",step:"0.1",placeholder:(y.tp?.rr,"1.5"),title:y.tp?.rr!==void 0?"Risk:Reward Ratio value":"Take Profit Percentage",value:y.tp?.rr??y.tp?.pct??1.5,onChange:e=>{let t=parseFloat(e.target.value)||1.5;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],tp:y.tp?.rr!==void 0?{rr:t}:{pct:t}}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",min:"0"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-semibold mb-3 text-purple-700",children:"üìä Volume Requirement"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Minimum Volume Ratio (x promedio)"}),(0,t.jsxs)("select",{title:"Select minimum volume ratio","aria-label":"Select minimum volume ratio",value:y.volumeMinRatio??2,onChange:e=>{let t=parseFloat(e.target.value)||2;eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],volumeMinRatio:t}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"1.0",children:"1.0x (Permite cualquier volumen)"}),(0,t.jsx)("option",{value:"1.5",children:"1.5x (Requiere volumen moderado)"}),(0,t.jsx)("option",{value:"2.0",children:"2.0x (Requiere volumen alto - recomendado)"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:1===y.volumeMinRatio?"Permite se√±ales con cualquier volumen (menos selectivo)":1.5===y.volumeMinRatio?"Solo se√±ales con volumen ‚â•1.5x promedio (moderadamente selectivo)":"Solo se√±ales con volumen ‚â•2.0x promedio (muy selectivo, requerido para trading activo)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-semibold mb-3 text-purple-700",children:"üìù Notes"}),(0,t.jsx)("textarea",{value:y.notes?.join("\n")??"",onChange:e=>{let t=e.target.value.split("\n").filter(e=>e.trim());eH(e=>({...e,[eK]:{...e[eK],rules:{...e[eK].rules,[eQ]:{...e[eK].rules[eQ],notes:t.length>0?t:void 0}}}}))},className:"w-full border border-purple-300 rounded px-3 py-2",rows:3,placeholder:"One note per line..."})]})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-purple-200",children:[(0,t.jsx)("h5",{className:"font-semibold mb-4 text-purple-700",children:"üìã How this preset executes trades"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h6",{className:"font-medium text-green-700 mb-2",children:"üü¢ Buy will trigger when:"}),(0,t.jsxs)("ul",{className:"list-none space-y-1 text-sm text-gray-700 pl-4",children:[(0,t.jsxs)("li",{children:["‚Ä¢ RSI ","<"," ",y.rsi?.buyBelow??40]}),y.maChecks?.ema10&&(0,t.jsx)("li",{children:"‚Ä¢ Price is above EMA10"}),y.maChecks?.ma50&&(0,t.jsx)("li",{children:"‚Ä¢ Price is above MA50"}),y.maChecks?.ma200&&(0,t.jsx)("li",{children:"‚Ä¢ Price is above MA200"}),!y.maChecks?.ema10&&!y.maChecks?.ma50&&!y.maChecks?.ma200&&(0,t.jsx)("li",{children:"‚Ä¢ No MA checks required"}),(0,t.jsxs)("li",{children:["‚Ä¢ Volume ‚â• ",y.volumeMinRatio??2,"x average"]}),(0,t.jsxs)("li",{children:["‚Ä¢ Then system places a BUY with SL = ",y.sl?.atrMult!==void 0?`ATR \xd7 ${y.sl.atrMult}`:y.sl?.pct!==void 0?`${y.sl.pct}%`:"Not configured"," and TP = ",y.tp?.rr!==void 0?`Risk:Reward ${y.tp.rr}`:y.tp?.pct!==void 0?`${y.tp.pct}%`:"Not configured"]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h6",{className:"font-medium text-red-700 mb-2",children:"üî¥ Sell will trigger when:"}),(0,t.jsxs)("ul",{className:"list-none space-y-1 text-sm text-gray-700 pl-4",children:[(0,t.jsx)("li",{children:"‚Ä¢ There is an open position"}),(0,t.jsxs)("li",{children:["‚Ä¢ RSI ",">"," ",y.rsi?.sellAbove??70]}),(0,t.jsx)("li",{children:"‚Ä¢ Price hits target/resistance"}),(0,t.jsx)("li",{children:"‚Ä¢ Then system places a SELL and updates the sheet"})]})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>{localStorage.setItem("strategy_presets_config",JSON.stringify(ez)),alert(`‚úÖ Configuration saved for ${eK} - ${eQ}`)},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:["üíæ Save ",eK," ",eQ]}),(0,t.jsx)("button",{onClick:()=>{eH(f),alert("üîÑ Reset to defaults")},className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:"üîÑ Reset to Defaults"})]})]}):null]}),k&&(0,t.jsxs)("div",{className:"bg-gray-50 border border-gray-300 rounded p-4 mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Add New Symbol"}),(0,t.jsxs)("div",{className:"flex gap-4 items-end",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Symbol (Crypto.com)"}),(0,t.jsx)("input",{type:"text",placeholder:"e.g., BTC_USDT",value:eN,onChange:e=>eS(e.target.value),onKeyDown:e=>{"Enter"===e.key&&tE()},className:"border border-gray-300 rounded px-3 py-2 w-full",title:"Symbol"})]}),(0,t.jsx)("button",{onClick:tE,disabled:N,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:bg-gray-400 h-fit",children:"Add"})]})]}),(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{className:"sticky top-0 z-10",children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-8",children:"#"}),(0,t.jsx)("th",{className:"px-2 py-3 text-left font-semibold w-20",children:"Symbol"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-16",children:"Actions"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-24",children:"Last Price"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-24",children:"Last Updated"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-20",children:"Preset"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-14",children:"Trade"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-32 min-w-[120px]",children:"Amount USD"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-16",children:"Margin"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-16",children:"RISK"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-20",children:"SL Price"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-20",children:"TP Price"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-16",children:"RSI"}),(0,t.jsx)("th",{className:"px-1 py-3 text-center font-semibold w-16",children:"ATR"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-24",children:"Res Up"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-24",children:"Res Down"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-18",children:"MA50"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-18",children:"MA200"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-18",children:"EMA10"}),(0,t.jsx)("th",{className:"px-2 py-3 text-right font-semibold w-18",children:"MA10w"}),(0,t.jsx)("th",{className:"px-2 py-3 text-center font-semibold w-20",children:"Volume"}),(0,t.jsx)("th",{className:"px-2 py-3 text-center font-semibold w-24",children:"Signals"}),(0,t.jsx)("th",{className:"px-2 py-3 text-center font-semibold w-20",children:"Actions"})]})}),(0,t.jsxs)("tbody",{children:[O&&0===E.length&&Array.from({length:6}).map((e,s)=>(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-6 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3",children:(0,t.jsx)(p,{className:"h-4 w-16"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-12 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-14 mx-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-10 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-12 mx-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-12 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-10 mx-auto"})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-10 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-16 ml-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-14 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-20 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-20 mx-auto"})}),(0,t.jsx)("td",{className:"px-2 py-3 text-center",children:(0,t.jsx)(p,{className:"h-4 w-16 mx-auto"})})]},`watchlist-skeleton-${s}`)),E.length>0&&E.slice().sort((e,t)=>{let s=el[e.instrument_name]||!1,a=el[t.instrument_name]||!1;return s&&!a?-1:!s&&a?1:(e.rank||0)-(t.rank||0)}).map((e,s)=>{let r,n,l,i,d,m,u,p,x,b,v,y,_,j,w,N,S;return(0,t.jsxs)("tr",{className:`hover:bg-gray-50 border-b ${el[e.instrument_name]?"bg-green-50 border-l-4 border-l-green-500":""}`,children:[(0,t.jsx)("td",{className:"px-1 py-3 font-medium text-center w-8",children:s+1}),(0,t.jsx)("td",{className:"px-2 py-3 font-medium w-20",children:(0,t.jsx)("a",{href:`https://crypto.com/exchange/trade/${e.instrument_name}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",title:`Abrir ${e.instrument_name} en Crypto.com Exchange (nueva ventana)`,children:e.instrument_name})}),(0,t.jsx)("td",{className:"px-1 py-3 text-center w-16",children:(0,t.jsxs)("div",{className:"flex gap-1 justify-center items-center",children:[(0,t.jsx)("button",{onClick:async()=>{let t=parseFloat(ed[e.instrument_name]||"0");if(!t||t<=0)return void alert(`Por favor configura el Amount USD para ${e.instrument_name}`);let s=el[e.instrument_name+"_margin"]||!1,r=e.current_price||0;if(!r||r<=0)return void alert(`No hay precio disponible para ${e.instrument_name}`);let n=t/r;n=r>=100?Math.round(1e4*n)/1e4:r>=1?Math.round(1e6*n)/1e6:Math.round(1e8*n)/1e8;let l=s?`üöÄ On Margin (10x)`:"üí∞ Spot",i=`üü¢ CONFIRMAR ORDEN BUY

üìä Symbol: ${e.instrument_name}
üí∞ Amount USD: $${t.toFixed(2)}
${l}
üí∏ Total: $${t.toFixed(2)}
üìã Type: MARKET
üí° La orden se ejecutar\xe1 al precio de mercado actual

\xbfConfirmar esta orden?`;if(window.confirm(i))try{let n=await (0,a.quickOrder)({symbol:e.instrument_name,side:"BUY",price:r,amount_usd:t,use_margin:s});alert(`‚úÖ Orden BUY creada exitosamente!

Order ID: ${n.order_id}${n.dry_run?"\nüß™ Modo: DRY RUN":"\nüî¥ Modo: LIVE"}`)}catch(s){let t=s.detail||s.message||"Error desconocido";g(`quickOrder:buy:${e.instrument_name}`,`‚ùå Error creating BUY order for ${e.instrument_name}`,{error:s,price:r},"error"),alert(`‚ùå Error creando orden BUY:

${t}

Precio usado: $${r.toFixed(4)}`)}},className:"px-2 py-1 text-xs font-semibold bg-green-500 hover:bg-green-600 text-white rounded transition-colors",title:`BUY ${e.instrument_name} @ $${e.current_price||0}`,children:"BUY"}),(0,t.jsx)("button",{onClick:async()=>{let t=parseFloat(ed[e.instrument_name]||"0");if(!t||t<=0)return void alert(`Por favor configura el Amount USD para ${e.instrument_name}`);let s=el[e.instrument_name+"_margin"]||!1,r=e.current_price||0;if(!r||r<=0)return void alert(`No hay precio disponible para ${e.instrument_name}`);let n=t/r;n=r>=100?Math.round(1e4*n)/1e4:r>=1?Math.round(1e6*n)/1e6:Math.round(1e8*n)/1e8;let l=s?`üöÄ On Margin (10x)`:"üí∞ Spot",i=`üî¥ CONFIRMAR ORDEN SELL

üìä Symbol: ${e.instrument_name}
üí∞ Amount USD: $${t.toFixed(2)}
üì¶ Quantity: ${n.toFixed(8)}
${l}
üí∏ Total estimado: $${(r*n).toFixed(2)}
üìã Type: MARKET
üí° La orden se ejecutar\xe1 al precio de mercado actual

\xbfConfirmar esta orden?`;if(window.confirm(i))try{let n=await (0,a.quickOrder)({symbol:e.instrument_name,side:"SELL",price:r,amount_usd:t,use_margin:s});alert(`‚úÖ Orden SELL creada exitosamente!

Order ID: ${n.order_id}${n.dry_run?"\nüß™ Modo: DRY RUN":"\nüî¥ Modo: LIVE"}`)}catch(s){let t=s.detail||s.message||"Error desconocido";g(`quickOrder:sell:${e.instrument_name}`,`‚ùå Error creating SELL order for ${e.instrument_name}`,{error:s,price:r},"error"),alert(`‚ùå Error creando orden SELL:

${t}

Precio usado: $${r.toFixed(4)}`)}},className:"px-2 py-1 text-xs font-semibold bg-red-500 hover:bg-red-600 text-white rounded transition-colors",title:`SELL ${e.instrument_name} @ $${e.current_price||0}`,children:"SELL"})]})}),(0,t.jsxs)("td",{className:"px-2 py-3 text-right font-semibold w-24",title:`Price last updated: ${eF[e.instrument_name]?.price?.toLocaleTimeString()||"Never"}
Price value: ${e.current_price}`,children:["$",h(e.current_price||0,e.instrument_name)]}),(0,t.jsx)("td",{className:"px-2 py-3 text-right w-24",title:th(e.instrument_name),children:(()=>{let t=eF[e.instrument_name];if(!t)return"‚Äî";let{price:s,signals:a}=t;return tp(a&&s?a>s?a:s:a||s)})()}),(0,t.jsxs)("td",{className:"px-1 py-3 text-center relative w-18",children:[(0,t.jsxs)("select",{value:eq[e.instrument_name]||"swing",onChange:t=>tM(e.instrument_name,t.target.value),onMouseEnter:()=>eY(e.instrument_name),onMouseLeave:()=>eY(null),className:"text-xs border border-gray-300 rounded px-2 py-1 bg-white w-20 relative z-10",title:("swing"===(l=eq[e.instrument_name]||"swing")||"intraday"===l||"scalp"===l?(r=l,n="Conservative"):l.includes("-conservative")?(r=l.replace("-conservative",""),n="Conservative"):l.includes("-aggressive")?(r=l.replace("-aggressive",""),n="Aggressive"):(r="Swing",n="Conservative"),i=e$[e?.instrument_name],tt(r,n,{rsi:i?.rsi,ema10:i?.ema10,ma50:i?.ma50,ma200:i?.ma200,atr:i?.atr,currentPrice:e?.current_price})),children:[(0,t.jsx)("option",{value:"swing-conservative",children:"Swing-Conservative"}),(0,t.jsx)("option",{value:"swing-aggressive",children:"Swing-Aggressive"}),(0,t.jsx)("option",{value:"intraday-conservative",children:"Intraday-Conservative"}),(0,t.jsx)("option",{value:"intraday-aggressive",children:"Intraday-Aggressive"}),(0,t.jsx)("option",{value:"scalp-conservative",children:"Scalp-Conservative"}),(0,t.jsx)("option",{value:"scalp-aggressive",children:"Scalp-Aggressive"}),(0,t.jsx)("option",{value:"custom",children:"Custom"})]}),eV===e.instrument_name&&(0,t.jsxs)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg shadow-lg z-50 whitespace-pre-line max-w-xs",children:[(()=>{let t,s,a=eq[e.instrument_name]||"swing";if("swing"===a||"intraday"===a||"scalp"===a)t=a.charAt(0).toUpperCase()+a.slice(1),s="Conservative";else if(a.includes("-conservative")){let e=a.replace("-conservative","");t=e.charAt(0).toUpperCase()+e.slice(1),s="Conservative"}else if(a.includes("-aggressive")){let e=a.replace("-aggressive","");t=e.charAt(0).toUpperCase()+e.slice(1),s="Aggressive"}else t="Swing",s="Conservative";let r=e$[e?.instrument_name];return tt(t,s,{rsi:r?.rsi,ema10:r?.ema10,ma50:r?.ma50,ma200:r?.ma200,atr:r?.atr,currentPrice:e?.current_price})})(),(0,t.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"})]})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-14",children:(0,t.jsx)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 transition-all w-12 justify-center ${el[e.instrument_name]?"bg-yellow-400 text-yellow-900 border border-yellow-500 font-bold":"bg-gray-100 text-gray-500 border border-gray-300"}`,onClick:async()=>{let t=!el[e.instrument_name];ei(s=>{let a={...s,[e.instrument_name]:t};return localStorage.setItem("watchlist_trade_status",JSON.stringify(a)),a});try{await (0,a.saveCoinSettings)(e.instrument_name,{trade_enabled:t})}catch(t){console.error(`‚ùå Failed to save trade_enabled for ${e.instrument_name}:`,t),alert(`Error saving trade status: ${t instanceof Error?t.message:String(t)}`)}},children:el[e.instrument_name]?(0,t.jsx)("span",{className:"font-bold",children:"YES"}):"NO"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-20",children:(0,t.jsx)("input",{type:"text",step:"0.01",placeholder:"$0.00",value:ed[e.instrument_name]||"",onChange:t=>{let s=t.target.value;em(t=>({...t,[e.instrument_name]:s}))},onBlur:async t=>{let s=t.target.value,r=parseFloat(s);if(!isNaN(r)&&r>0){let t={...ed,[e.instrument_name]:s};em(t);try{localStorage.setItem("watchlist_amounts",JSON.stringify(t))}catch(e){g("localStorage:watchlist_amounts","Failed to persist watchlist amounts to localStorage",e)}try{await (0,a.saveCoinSettings)(e.instrument_name,{trade_amount_usd:r})}catch(e){console.warn(`‚ö†Ô∏è Backend save failed (using localStorage only): ${e}`)}}},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:`w-full border-2 rounded-lg px-3 py-2 shadow-sm focus:outline-none focus:ring-2 text-right font-medium ${el[e.instrument_name]&&(!ed[e.instrument_name]||""===ed[e.instrument_name])?"border-red-500 focus:ring-red-500 bg-red-50 text-red-900":"border-blue-300 focus:ring-blue-500 bg-white"}`})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-14",children:(0,t.jsx)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 transition-all w-12 justify-center ${el[e.instrument_name+"_margin"]?"bg-yellow-400 text-yellow-900 border border-yellow-500 font-bold":"bg-gray-100 text-gray-500 border border-gray-300"}`,onClick:async()=>{let t=!el[e.instrument_name+"_margin"];ei(s=>{let a={...s,[e.instrument_name+"_margin"]:t};return localStorage.setItem("watchlist_trade_status",JSON.stringify(a)),a}),await (0,a.saveCoinSettings)(e.instrument_name,{trade_on_margin:t})},children:el[e.instrument_name+"_margin"]?"YES":"NO"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-16",children:(0,t.jsx)("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium cursor-pointer hover:opacity-80 transition-all w-14 justify-center ${el[e.instrument_name+"_sl_tp"]?"bg-red-100 text-red-700 border border-red-300":"bg-green-100 text-green-700 border border-green-300"}`,onClick:async()=>{let t,s=!el[e.instrument_name+"_sl_tp"];ei(t=>({...t,[e.instrument_name+"_sl_tp"]:s}));let r=eq[e.instrument_name]||"swing";t="swing"===r||"intraday"===r||"scalp"===r?s?`${r}-aggressive`:`${r}-conservative`:r.includes("-conservative")?s?r.replace("-conservative","-aggressive"):r:r.includes("-aggressive")?s?r:r.replace("-aggressive","-conservative"):s?"swing-aggressive":"swing-conservative",eJ(s=>({...s,[e.instrument_name]:t})),await (0,a.saveCoinSettings)(e.instrument_name,{sl_tp_mode:s?"aggressive":"conservative"});let n=tc(e);ef(t=>({...t,[e.instrument_name]:n.sl})),ev(t=>({...t,[e.instrument_name]:n.tp}));try{let t={sl_tp_mode:s?"aggressive":"conservative"};n.sl&&(t.sl_price=n.sl),n.tp&&(t.tp_price=n.tp),await (0,a.saveCoinSettings)(e.instrument_name,t)}catch(t){console.warn(`‚ö†Ô∏è Failed to save recalculated SL/TP for ${e.instrument_name}:`,t)}},title:(d="swing"===(m=eq[e.instrument_name]||"swing")||"intraday"===m||"scalp"===m?m:m.includes("-conservative")||m.includes("-aggressive")?m.replace("-conservative","").replace("-aggressive",""):"Swing",u=el[e?.instrument_name+"_sl_tp"]?"Aggressive":"Conservative",p=e$[e?.instrument_name],tt(d,u,{rsi:p?.rsi,ema10:p?.ema10,ma50:p?.ma50,ma200:p?.ma200,atr:p?.atr,currentPrice:e?.current_price})),children:el[e.instrument_name+"_sl_tp"]?"Aggressive":"Conservative"})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right w-20",children:[(0,t.jsx)("input",{type:"text",step:"0.01",placeholder:eg[e.instrument_name]?h(eg[e.instrument_name],e.instrument_name):"Calculating...",value:(b=ej[e.instrument_name]?.sl,v=ey[e.instrument_name]?.sl,y=eu[e.instrument_name]&&""!==eu[e.instrument_name],_=eg[e.instrument_name],b?eu[e.instrument_name]||"":v&&y?eu[e.instrument_name]:y?eu[e.instrument_name]:void 0!==_&&_>0?h(_,e.instrument_name):""),onFocus:()=>{ew(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],sl:!0}}))},onChange:t=>{let s=t.target.value;ep(t=>({...t,[e.instrument_name]:s}))},onMouseEnter:()=>{eu[e.instrument_name]&&e_(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],sl:!0}}))},onMouseLeave:()=>{e_(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],sl:!1}}))},onBlur:async t=>{ew(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],sl:!1}}));let s=t.target.value,r=parseFloat(s);if(""===s||"0"===s){ep(t=>{let s={...t};return delete s[e.instrument_name],s});try{let t={...eu};delete t[e.instrument_name],localStorage.setItem("watchlist_sl_percent",JSON.stringify(t))}catch(e){g("localStorage:watchlist_sl_percent:clear","Failed to clear SL% override in localStorage",e)}try{await (0,a.saveCoinSettings)(e.instrument_name,{sl_percentage:void 0})}catch(e){console.warn("‚ö†Ô∏è Backend clear failed for SL%",e)}}else if(!isNaN(r)&&r>0){ep(t=>({...t,[e.instrument_name]:s}));try{let t={...eu,[e.instrument_name]:s};localStorage.setItem("watchlist_sl_percent",JSON.stringify(t))}catch(e){g("localStorage:watchlist_sl_percent:save","Failed to save SL% override to localStorage",e)}try{await (0,a.saveCoinSettings)(e.instrument_name,{sl_percentage:r})}catch(e){console.warn("‚ö†Ô∏è Backend save failed for SL%",e)}}},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:`w-32 border-2 rounded px-2 py-1 shadow-sm focus:outline-none focus:ring-2 text-right font-medium ${eu[e.instrument_name]&&""!==eu[e.instrument_name]?"border-purple-400 focus:ring-purple-500 bg-purple-50 text-purple-900":"border-blue-300 focus:ring-blue-500 bg-blue-50 text-blue-900"}`,title:eu[e.instrument_name]?`Override: ${eu[e.instrument_name]}% | Price: $${h(eg[e.instrument_name]||0,e.instrument_name)}`:`Price: $${h(eg[e.instrument_name]||0,e.instrument_name)} (from resistance levels)`}),eu[e.instrument_name]&&""!==eu[e.instrument_name]?(0,t.jsx)("span",{className:"ml-1 text-sm text-purple-600 font-semibold",children:"%"}):(0,t.jsx)("span",{className:"ml-1 text-sm text-blue-600 font-semibold",children:"$"})]}),(0,t.jsxs)("td",{className:"px-4 py-3 text-right w-20",children:[(0,t.jsx)("input",{type:"text",step:"0.01",placeholder:eb[e.instrument_name]?h(eb[e.instrument_name],e.instrument_name):"Calculating...",value:(j=ej[e.instrument_name]?.tp,w=ey[e.instrument_name]?.tp,N=eh[e.instrument_name]&&""!==eh[e.instrument_name],S=eb[e.instrument_name],j?eh[e.instrument_name]||"":w&&N?eh[e.instrument_name]:N?eh[e.instrument_name]:void 0!==S&&S>0?h(S,e.instrument_name):""),onFocus:()=>{ew(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],tp:!0}}))},onChange:t=>{let s=t.target.value;ex(t=>({...t,[e.instrument_name]:s}))},onMouseEnter:()=>{eh[e.instrument_name]&&e_(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],tp:!0}}))},onMouseLeave:()=>{e_(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],tp:!1}}))},onBlur:async t=>{ew(t=>({...t,[e.instrument_name]:{...t[e.instrument_name],tp:!1}}));let s=t.target.value,r=parseFloat(s);if(""===s||"0"===s){ex(t=>{let s={...t};return delete s[e.instrument_name],s});try{let t={...eh};delete t[e.instrument_name],localStorage.setItem("watchlist_tp_percent",JSON.stringify(t))}catch(e){g("localStorage:watchlist_tp_percent:clear","Failed to clear TP% override in localStorage",e)}try{await (0,a.saveCoinSettings)(e.instrument_name,{tp_percentage:void 0})}catch(e){console.warn("‚ö†Ô∏è Backend clear failed for TP%",e)}}else if(!isNaN(r)&&r>0){ex(t=>({...t,[e.instrument_name]:s}));try{let t={...eh,[e.instrument_name]:s};localStorage.setItem("watchlist_tp_percent",JSON.stringify(t))}catch(e){g("localStorage:watchlist_tp_percent:save","Failed to save TP% override to localStorage",e)}try{await (0,a.saveCoinSettings)(e.instrument_name,{tp_percentage:r})}catch(e){console.warn("‚ö†Ô∏è Backend save failed for TP%",e)}}},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:`w-32 border-2 rounded px-2 py-1 shadow-sm focus:outline-none focus:ring-2 text-right font-medium ${eh[e.instrument_name]&&""!==eh[e.instrument_name]?"border-purple-400 focus:ring-purple-500 bg-purple-50 text-purple-900":"border-blue-300 focus:ring-blue-500 bg-blue-50 text-blue-900"}`,title:eh[e.instrument_name]?`Override: ${eh[e.instrument_name]}% | Price: $${h(eb[e.instrument_name]||0,e.instrument_name)}`:`Price: $${h(eb[e.instrument_name]||0,e.instrument_name)} (from resistance levels)`}),eh[e.instrument_name]&&""!==eh[e.instrument_name]?(0,t.jsx)("span",{className:"ml-1 text-sm text-purple-600 font-semibold",children:"%"}):(0,t.jsx)("span",{className:"ml-1 text-sm text-blue-600 font-semibold",children:"$"})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-14",title:`RSI last updated: ${eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never"}`,children:e$[e.instrument_name]?.rsi!==void 0?(0,t.jsx)("span",{className:`font-semibold ${(()=>{let t,s,a=e$[e.instrument_name]?.rsi||0,r=eq[e.instrument_name]||"swing";if("swing"===r||"intraday"===r||"scalp"===r)t=r,s="Conservative";else if(r.includes("-conservative")){let e=r.replace("-conservative","");t=e.charAt(0).toUpperCase()+e.slice(1),s="Conservative"}else if(r.includes("-aggressive")){let e=r.replace("-aggressive","");t=e.charAt(0).toUpperCase()+e.slice(1),s="Aggressive"}else t="Swing",s="Conservative";let n=ez[t]?.rules[s]||f[t]?.rules[s];if(!n?.rsi)return a<30||a>70?"text-red-600 font-bold":a<40||a>60?"text-orange-500 font-semibold":"text-green-600 font-semibold";let l=n.rsi.buyBelow||40,i=n.rsi.sellAbove||70;return a<l?"text-green-600 font-bold":a>i?"text-red-600 font-bold":"text-orange-500 font-semibold"})()}`,children:(e$[e.instrument_name]?.rsi||0).toFixed(1)}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-14",title:`ATR last updated: ${eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never"}`,children:e$[e.instrument_name]?.atr!==void 0?(0,t.jsx)("span",{className:`font-semibold ${(x=(e$[e.instrument_name]?.atr||0)/(e.current_price||1)*100)<1?"text-green-600":x<=3?"text-orange-500":"text-red-600 font-bold"}`,children:h(e$[e.instrument_name]?.atr||0,e.instrument_name)}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-24",title:`Resistance up updated: ${eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never"}`,children:e$[e.instrument_name]?.res_up!==void 0?(0,t.jsxs)("span",{className:e.current_price<(e$[e.instrument_name]?.res_up||0)?o:c,children:["$",h(e$[e.instrument_name]?.res_up||0,e.instrument_name)]}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-24",title:`Support down updated: ${eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never"}`,children:e$[e.instrument_name]?.res_down!==void 0?(0,t.jsxs)("span",{className:e.current_price>(e$[e.instrument_name]?.res_down||0)?o:c,children:["$",h(e$[e.instrument_name]?.res_down||0,e.instrument_name)]}):(0,t.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-18",children:(()=>{let s=e$[e?.instrument_name],{colorClass:a,tooltip:r}=ts(e,"MA50",s,eq),n=eF[e?.instrument_name]?.signals?.toLocaleTimeString()||"Never";return s?.ma50!==void 0?(0,t.jsxs)("span",{className:`${a} font-bold`,title:`${r}

Last updated: ${n}`,children:["$",h(s.ma50||0)]}):(0,t.jsx)("span",{className:"text-gray-400",title:"MA50 data not available",children:"-"})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-18",children:(()=>{let s=e$[e.instrument_name],{colorClass:a,tooltip:r}=ts(e,"MA200",s,eq),n=eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never";return s?.ma200!==void 0?(0,t.jsxs)("span",{className:`${a} font-bold`,title:`${r}

Last updated: ${n}`,children:["$",h(s.ma200||0)]}):(0,t.jsx)("span",{className:"text-gray-400",title:"MA200 data not available",children:"-"})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-18",children:(()=>{let s=e$[e.instrument_name],{colorClass:a,tooltip:r}=ts(e,"EMA10",s,eq),n=eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never";return s?.ema10!==void 0?(0,t.jsxs)("span",{className:`${a} font-bold`,title:`${r}

Last updated: ${n}`,children:["$",h(s.ema10||0)]}):(0,t.jsx)("span",{className:"text-gray-400",title:"EMA10 data not available",children:"-"})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-right w-18",children:(()=>{let s=e$[e.instrument_name],{colorClass:a,tooltip:r}=ts(e,"MA10w",s,eq),n=eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never";return s?.ma10w!==void 0?(0,t.jsxs)("span",{className:`${a} font-bold`,title:`${r}

Last updated: ${n}`,children:["$",h(s.ma10w||0)]}):(0,t.jsx)("span",{className:"text-gray-400",title:"MA10w data not available",children:"-"})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-20",title:`Volume last updated: ${eF[e.instrument_name]?.signals?.toLocaleTimeString()||"Never"}`,children:(()=>{let s,a,r,n,l,i,o=e$[e.instrument_name];if(o?.volume_ratio!==void 0&&o.volume_ratio>0?(n=o.volume_ratio,l=o.volume,i=o.avg_volume):o?.volume!==void 0&&o?.avg_volume!==void 0&&(o.avg_volume??0)>0&&(l=o.volume,n=l/(i=o.avg_volume)),void 0===n||!(n>0))return(0,t.jsx)("span",{className:"text-gray-400",title:"Volume data not available",children:"-"});return s=n.toFixed(1),a="text-gray-600",r="font-semibold",n>=1.5?(a="text-green-600",r="font-bold"):n>=1.2?(a="text-green-500",r="font-semibold"):n>=1?(a="text-orange-500",r="font-semibold"):n>=.8?(a="text-gray-600",r="font-normal"):(a="text-red-500",r="font-semibold"),(0,t.jsxs)("span",{className:`text-sm ${a} ${r}`,title:void 0!==l&&void 0!==i?`Current volume: ${l.toLocaleString()} | Average (10 periods): ${i.toLocaleString()} | Ratio: ${s}x`:`Volume ratio: ${s}x`,children:[s,"x"]})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-24",children:(()=>{let s,a,r=e$[e.instrument_name]?.signals;if(!r)return(0,t.jsx)("span",{className:"text-gray-400",children:"WAIT"});let n=eq[e.instrument_name]||"swing";if("swing"===n||"intraday"===n||"scalp"===n)s=n,a="Conservative";else if(n.includes("-conservative")){let e=n.replace("-conservative","");s=e.charAt(0).toUpperCase()+e.slice(1),a="Conservative"}else if(n.includes("-aggressive")){let e=n.replace("-aggressive","");s=e.charAt(0).toUpperCase()+e.slice(1),a="Aggressive"}else s="Swing",a="Conservative";let l=ez[s]?.rules[a]||f[s]?.rules[a],i=e$[e.instrument_name]?.rsi,o=e$[e.instrument_name]?.ma50,c=e$[e.instrument_name]?.ema10,d=e$[e.instrument_name]?.ma200,m=e.current_price,u="WAIT";if(void 0!==i&&void 0!==o&&void 0!==c&&m){let t=l?.rsi?.buyBelow||40,s=l?.rsi?.sellAbove||70,a=l?.maChecks?.ma50||!1;l?.maChecks?.ema10;let r=l?.maChecks?.ma200||!1,n=i<t;a&&void 0!==o&&void 0!==c&&(n=n&&o>c),r&&void 0!==d&&m&&(n=n&&m>d);let p=l?.volumeMinRatio||2,h=e$[e.instrument_name]?.volume,x=e$[e.instrument_name]?.avg_volume;void 0!==h&&void 0!==x&&x>0&&(n=n&&h/x>=p);let g=!1,f=i>s,b=!1;if(a&&void 0!==o&&void 0!==c){let e=Math.abs(o-c),t=(o+c)/2;b=o<c&&e/t*100>=.5}let v=e$[e.instrument_name]?.volume,y=e$[e.instrument_name]?.avg_volume,_=!1;_=void 0===v||void 0===y||!(y>0)||v/y>=p,g=a?f&&b&&_:f&&_,u=n&&!g?"BUY":g?"SELL":"WAIT"}else r.buy?u="BUY":r.sell&&(u="SELL");let p=function(e,t,s,a,r,n,l,i,o,c){if(!s)return"Estrategia no configurada";let d=s.volumeMinRatio||2,m=[];m.push(`üìä ${e} \xb7 ${t}`),m.push(""),m.push("üü¢ CRITERIOS BUY (todos deben cumplirse):");let u=s.rsi?.buyBelow||40,p=void 0!==a?a<u?"‚úì":"‚úó":"?";if(m.push(`  ‚Ä¢ RSI < ${u} ${void 0!==a?`(actual: ${a.toFixed(1)}${p})`:""}`),s.maChecks?.ma50&&void 0!==r&&void 0!==n){let e=r>n?"‚úì":"‚úó";m.push(`  ‚Ä¢ MA50 > EMA10 ${e}`),m.push(`    - MA50: $${h(r)}`),m.push(`    - EMA10: $${h(n)}`)}if(s.maChecks?.ma200&&void 0!==l&&i){let e=i>l?"‚úì":"‚úó";m.push(`  ‚Ä¢ Precio > MA200 ${e}`),m.push(`    - Precio: $${h(i)}`),m.push(`    - MA200: $${h(l)}`)}if(void 0!==o&&void 0!==c&&c>0){let e=o/c,t=e>=d?"‚úì":"‚úó";m.push(`  ‚Ä¢ Volume ‚â• ${d}x promedio ${t}`),m.push(`    - Ratio actual: ${e.toFixed(2)}x`),m.push(`    - Volume: ${o.toLocaleString()}`),m.push(`    - Promedio: ${c.toLocaleString()}`)}else m.push(`  ‚Ä¢ Volume ‚â• ${d}x promedio ? (datos no disponibles)`);s.maChecks?.ma50||s.maChecks?.ma200||m.push(`  ‚Ä¢ No se requieren MAs`),m.push(""),s.maChecks?.ma50?m.push("üî¥ CRITERIOS SELL (AMBOS deben cumplirse):"):m.push("üî¥ CRITERIOS SELL:");let x=s.rsi?.sellAbove||70,g=void 0!==a?a>x?"‚úì":"‚úó":"?";if(m.push(`  ‚Ä¢ RSI > ${x} ${void 0!==a?`(actual: ${a.toFixed(1)}${g})`:""}`),s.maChecks?.ma50&&void 0!==r&&void 0!==n){let e=Math.abs(r-n)/((r+n)/2)*100,t=r<n&&e>=.5;m.push(`  ‚Ä¢ MA50 < EMA10 (diferencia ‚â•0.5%) ${t?"‚úì":"‚úó"}`),m.push(`    - MA50: $${h(r)}`),m.push(`    - EMA10: $${h(n)}`),m.push(`    - Diferencia: ${e.toFixed(2)}% ${r<n?"(requiere ‚â•0.5%)":""}`)}if(void 0!==o&&void 0!==c&&c>0){let e=o/c,t=e>=d?"‚úì":"‚úó";m.push(`  ‚Ä¢ Volume ‚â• ${d}x promedio ${t}`),m.push(`    - Ratio actual: ${e.toFixed(2)}x`),m.push(`    - Volume: ${o.toLocaleString()}`),m.push(`    - Promedio: ${c.toLocaleString()}`)}else m.push(`  ‚Ä¢ Volume ‚â• ${d}x promedio ? (datos no disponibles)`);m.push("");let f=void 0!==a&&a<u;if(s.maChecks?.ma50&&void 0!==r&&void 0!==n&&(f=f&&r>n),s.maChecks?.ma200&&void 0!==l&&i&&(f=f&&i>l),void 0!==o&&void 0!==c&&c>0){let e=o/c;f=f&&e>=d}let b=!1,v=void 0!==a&&a>x,y=!1,_=0;s.maChecks?.ma50&&void 0!==r&&void 0!==n&&(_=Math.abs(r-n)/((r+n)/2)*100,y=r<n&&_>=.5);let j=!1;if(j=void 0===o||void 0===c||!(c>0)||o/c>=d,b=s.maChecks?.ma50?v&&y&&j:v&&j,m.push("üìå ESTADO ACTUAL:"),f&&!b)m.push("  ‚Üí Se√±al: BUY (todos los criterios BUY cumplidos, ninguno SELL activo)");else if(b)m.push("  ‚Üí Se√±al: SELL (todos los criterios SELL cumplidos)"),s.maChecks?.ma50&&!y&&void 0!==r&&void 0!==n&&r<n&&m.push(`  ‚ö†Ô∏è Nota: MA50 < EMA10 pero diferencia (${_.toFixed(2)}%) < 0.5% - muy peque\xf1o, puede ser ruido`);else if(m.push("  ‚Üí Se√±al: WAIT (no se cumplen todos los criterios BUY, no hay criterios SELL activos)"),v&&s.maChecks?.ma50&&!y&&m.push(`  ‚ÑπÔ∏è RSI > ${x} pero MA50 no confirma inversi\xf3n (diferencia < 0.5%)`),void 0!==o&&void 0!==c&&c>0){let e=o/c;e<d&&m.push(`  ‚ö†Ô∏è Volume ratio (${e.toFixed(2)}x) < ${d}x - mercado sin suficiente reacci\xf3n`)}return m.join("\n")}(s,a,l,i,o,c,d,m,e$[e.instrument_name]?.volume,e$[e.instrument_name]?.avg_volume);return(0,t.jsx)("span",{className:{BUY:"bg-green-500 text-white font-bold px-3 py-1 rounded",SELL:"bg-red-500 text-white font-bold px-3 py-1 rounded",WAIT:"bg-gray-400 text-white font-semibold px-3 py-1 rounded"}[u],title:p,children:u})})()}),(0,t.jsx)("td",{className:"px-4 py-3 text-center w-20",children:(0,t.jsxs)("div",{className:"flex gap-2 justify-center flex-wrap",children:[(0,t.jsxs)("button",{onClick:async()=>{let t=e.instrument_name,s=eo[t]||!1,r=!s;ec(e=>{let s={...e,[t]:r};return localStorage.setItem("watchlist_alert_status",JSON.stringify(s)),s});try{await (0,a.updateWatchlistAlert)(t,r)}catch(e){console.warn(`‚ö†Ô∏è updateWatchlistAlert failed for ${t}, trying fallback:`,e);try{await (0,a.saveCoinSettings)(t,{alert_enabled:r})}catch(r){console.error(`‚ùå Both endpoints failed for ${t}:`,{alertError:e,fallbackError:r}),ec(e=>{let a={...e,[t]:s};return localStorage.setItem("watchlist_alert_status",JSON.stringify(a)),a}),g(`updateWatchlistAlert:${t}`,`‚ùå Error updating alert status for ${t} (both endpoints failed)`,r,"error");let a=r.detail||r.message||e.detail||e.message||String(r);a.includes("Failed to fetch")||a.includes("Network error")?alert(`‚ö†Ô∏è Network Error

No se pudo conectar con el backend. Por favor verifica:

1. Que el backend est\xe9 ejecut\xe1ndose
2. Que la conexi\xf3n de red est\xe9 funcionando
3. Intenta refrescar la p\xe1gina

El estado se guard\xf3 localmente y se sincronizar\xe1 cuando se restablezca la conexi\xf3n.`):alert(`Error updating alert status: ${a}`)}}},className:`px-3 py-1 rounded text-sm font-semibold ${eo[e.instrument_name]?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-400 hover:bg-gray-500 text-white"}`,title:`Alert: ${eo[e.instrument_name]?"YES":"NO"}`,children:["ALERT ",eo[e.instrument_name]?"YES":"NO"]}),(0,t.jsx)("button",{onClick:async()=>{let t=e.instrument_name,s=ed[t]?parseFloat(ed[t]):void 0;if(!s||s<=0)return void alert(`‚ö†Ô∏è CONFIGURACI\xd3N REQUERIDA

El campo 'Amount USD' no est\xe1 configurado para ${t}.

Por favor configura el campo 'Amount USD' en la Watchlist del Dashboard antes de crear \xf3rdenes.`);if(window.confirm(`üß™ \xbfSimular alerta BUY para ${t}?

Esto enviar\xe1 una notificaci\xf3n de Telegram y crear\xe1 una orden autom\xe1ticamente.

üí∞ Amount: $${s.toFixed(2)} USD`))try{let e=await (0,a.simulateAlert)(t,"BUY",!0,s),r=`‚úÖ Alerta simulada exitosamente!

`;r+=`üìä Symbol: ${e.symbol}
üîÑ Signal: ${e.signal_type}
üíµ Price: $${e.price.toFixed(4)}
üì¢ Alert sent: ${e.alert_sent?"‚úÖ":"‚ùå"}
üì¶ Order created: ${e.order_created?"‚úÖ":"‚ùå"}
`,e.trade_amount_usd&&(r+=`üí∞ Amount: $${e.trade_amount_usd.toFixed(2)}
`),e.order_error?r=`‚ö†Ô∏è ${e.order_error}`:e.note&&(r+=`

üí° ${e.note}`),alert(r)}catch(s){g(`simulateAlert:${t}`,`‚ùå Error simulando alerta para ${t}`,s,"error");let e=s.detail||s.message||"Error desconocido";alert(`‚ùå Error simulando alerta:

${e}`)}},className:"px-2 py-1 rounded text-xs font-semibold bg-purple-600 hover:bg-purple-700 text-white",title:"üß™ Simular alerta BUY (TEST)",children:"üß™ TEST"}),(0,t.jsx)("button",{onClick:()=>{tP(e.instrument_name)},className:`px-3 py-1 rounded text-sm ${ek===e.instrument_name?"bg-orange-600 hover:bg-orange-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:ek===e.instrument_name?"Confirm?":"Delete"})]})})]},e.rank||s)}),!O&&0===E.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:22,className:"px-4 py-6 text-center text-gray-500",children:"No watchlist data available."})})]})]})]}),"orders"===j&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Open Orders - Crypto.com"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[z&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,t.jsx)("span",{className:"mr-2",children:"üïê"}),"Last update: ",z.toLocaleString()]}),X&&(0,t.jsx)("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${X.is_running?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,title:X.reason||void 0,children:X.is_running?"üü¢ Bot Activo":"üî¥ Bot Detenido"}),(0,t.jsx)("button",{onClick:()=>tC({showLoader:!0}),disabled:V,className:`px-4 py-2 rounded-lg font-medium transition-all ${V?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}`,children:V?"üîÑ Updating...":"‚Üª Refresh"})]})]}),(0,t.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Symbol"}),(0,t.jsx)("input",{type:"text",placeholder:"e.g., BTC_USDT",value:er.symbol,onChange:e=>en({...er,symbol:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),(0,t.jsxs)("select",{value:er.status,onChange:e=>en({...er,status:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",title:"Filter by Status",children:[(0,t.jsx)("option",{value:"",children:"All Statuses"}),(0,t.jsx)("option",{value:"ACTIVE",children:"Active"}),(0,t.jsx)("option",{value:"PENDING",children:"Pending"}),(0,t.jsx)("option",{value:"FILLED",children:"Filled"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Side"}),(0,t.jsxs)("select",{value:er.side,onChange:e=>en({...er,side:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",title:"Filter by Side",children:[(0,t.jsx)("option",{value:"",children:"Both Sides"}),(0,t.jsx)("option",{value:"BUY",children:"Buy"}),(0,t.jsx)("option",{value:"SELL",children:"Sell"})]})]})]}),V?(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Symbol"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Side"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Quantity"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Price"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Wallet Balance"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"})]})}),(0,t.jsx)("tbody",{children:Array.from({length:5}).map((e,s)=>(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-32"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-16"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-20"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-24"})})]},`open-order-skeleton-${s}`))})]}):e9.length>0?(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Symbol"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Side"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Quantity"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Price"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Wallet Balance"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"})]})}),(0,t.jsx)("tbody",{children:e9.map(e=>{let s=e.instrument_name.split("_")[0]?.toUpperCase()||"",a=T.length>0?T.find(e=>e.asset.toUpperCase()===s):$?.assets.find(e=>e.coin.toUpperCase()===s),r=a?"free"in a?(a.free||0)+(a.locked||0):a.balance||0:0,n=r>0;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50 border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium",children:e.instrument_name}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(m,{variant:"BUY"===e.side?"success":"danger",children:e.side})}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.order_type}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(parseFloat(e.quantity))}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:e.price&&parseFloat(e.price)>0?h(parseFloat(e.price)):"MARKET"===e.order_type||"TAKE_PROFIT_LIMIT"===e.order_type?(0,t.jsx)("span",{className:"text-gray-500 italic",children:"MARKET"}):(0,t.jsx)("span",{className:"text-gray-400 italic",children:"‚Äî"})}),(0,t.jsx)("td",{className:`px-4 py-3 text-right ${n?"bg-yellow-100":""}`,children:n?(0,t.jsxs)("span",{className:"font-medium text-yellow-800",children:[h(r)," ",s]}):(0,t.jsx)("span",{className:"text-gray-400 italic",children:"‚Äî"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(m,{variant:"warning",children:e.status})})]},e.order_id)})})]}):(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,t.jsx)("p",{children:"No open orders found."})})]}),"executed-orders"===j&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold",children:"Executed Orders - Crypto.com"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[Q&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[(0,t.jsx)("span",{className:"mr-2",children:"üïê"}),"√öltima actualizaci√≥n: ",Q.toLocaleString()]}),X&&(0,t.jsx)("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${X.is_running?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,title:X.reason||void 0,children:X.is_running?"üü¢ Bot Activo":"üî¥ Bot Detenido"}),(0,t.jsx)("button",{onClick:()=>t$({showLoader:!0}),disabled:K,className:`px-4 py-2 rounded-lg font-medium transition-all ${K?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800"}`,children:K?"üîÑ Updating...":"‚Üª Refresh"})]})]}),(0,t.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por Moneda"}),(0,t.jsx)("input",{type:"text",placeholder:"e.g., BTC_USDT, LDO_USD",value:er.symbol,onChange:e=>en({...er,symbol:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",title:"Filtrar por s√≠mbolo de moneda"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por Tipo de Ejecuci√≥n"}),(0,t.jsxs)("select",{value:er.side,onChange:e=>en({...er,side:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",title:"Filtrar por tipo de ejecuci√≥n",children:[(0,t.jsx)("option",{value:"",children:"Ambos (BUY y SELL)"}),(0,t.jsx)("option",{value:"BUY",children:"Compra (BUY)"}),(0,t.jsx)("option",{value:"SELL",children:"Venta (SELL)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por Estado"}),(0,t.jsxs)("select",{value:er.status,onChange:e=>en({...er,status:e.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",title:"Filtrar por estado",children:[(0,t.jsx)("option",{value:"",children:"Todos los Estados"}),(0,t.jsx)("option",{value:"FILLED",children:"Ejecutadas (FILLED)"}),(0,t.jsx)("option",{value:"CANCELLED",children:"Canceladas (CANCELLED)"}),(0,t.jsx)("option",{value:"ACTIVE",children:"Activas (ACTIVE)"})]})]})]}),er.symbol||er.side||er.status?(0,t.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:["Mostrando ",te.length," de ",es.length," √≥rdenes ejecutadas"]}):null,K?(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Symbol"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Side"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Quantity"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Price"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Total Value"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Execution Time"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"})]})}),(0,t.jsx)("tbody",{children:Array.from({length:5}).map((e,s)=>(0,t.jsxs)("tr",{className:"border-b",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-32"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-16"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-20"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-20 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(p,{className:"h-4 w-24 ml-auto"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-32"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(p,{className:"h-4 w-24"})})]},`executed-order-skeleton-${s}`))})]}):te.length>0?(0,t.jsxs)(u,{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gradient-to-r from-gray-800 to-gray-700 text-white",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Symbol"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Side"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Type"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Quantity"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Price"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right font-semibold",children:"Total Value"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Execution Time"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left font-semibold",children:"Status"})]})}),(0,t.jsx)("tbody",{children:te.map((e,s)=>{let a,r,n=e.update_time||e.create_time,l=n?new Date(n):null,i=l?l.toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}):"‚Äî",o=e.imported_at?new Date(e.imported_at):null,c=(()=>{if(!e.imported_at||!o)return!1;if((new Date().getTime()-o.getTime())/36e5<48)return!0;let t=te.filter(e=>e.imported_at);if(t.length>0){let s=Math.max(...t.map(e=>e.imported_at||0));if(e.imported_at===s)return!0}return!1})();return(0,t.jsxs)("tr",{className:`border-b ${c?"bg-yellow-100 hover:bg-yellow-200":"hover:bg-gray-50"}`,children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium",children:e.instrument_name}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(m,{variant:"BUY"===e.side?"success":"danger",children:e.side})}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.order_type}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:h(parseFloat(e.quantity))}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:e.price&&parseFloat(e.price)>0?h(parseFloat(e.price)):"MARKET"===e.order_type||"TAKE_PROFIT_LIMIT"===e.order_type?(0,t.jsx)("span",{className:"text-gray-500 italic",children:"MARKET"}):(0,t.jsx)("span",{className:"text-gray-400 italic",children:"‚Äî"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right font-medium",children:(a=parseFloat(e.quantity)||0,r=e.price?parseFloat(e.price):0,e.cumulative_value&&parseFloat(e.cumulative_value)>0?`$${h(parseFloat(e.cumulative_value))}`:a>0&&r>0?`$${h(a*r)}`:(0,t.jsx)("span",{className:"text-gray-400 italic",children:"‚Äî"}))}),(0,t.jsxs)("td",{className:"px-4 py-3 text-sm text-gray-600",children:[i,o&&(0,t.jsxs)("span",{className:"ml-2 text-xs text-gray-400",children:["(Import: ",o.toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}),")"]})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(m,{variant:"FILLED"===e.status?"success":"neutral",children:e.status})})]},e.order_id)})})]}):(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,t.jsx)("p",{children:"No executed orders found."})})]}),"version-history"===j&&(0,t.jsx)(_,{})]})}function _(){let[e,a]=(0,s.useState)(new Set),r=({id:s,title:r,children:n})=>{let l=e.has(s);return(0,t.jsxs)("div",{className:"mb-4 border rounded-lg overflow-hidden",children:[(0,t.jsxs)("button",{onClick:()=>{a(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"w-full px-6 py-4 text-left bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 transition-all flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-semibold text-lg text-gray-800",children:r}),(0,t.jsx)("span",{className:"text-2xl text-gray-600",children:l?"‚àí":"+"})]}),l&&(0,t.jsx)("div",{className:"px-6 py-4 bg-white",children:n})]})},n=b[b.length-1];return(0,t.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold mb-2",children:"Version History"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Complete changelog of all updates and improvements"})]}),(0,t.jsxs)("div",{className:"mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"text-2xl font-bold text-gray-900",children:["Current Version: v",n.version]}),(0,t.jsx)("span",{className:"px-3 py-1 bg-blue-600 text-white rounded-full text-sm font-semibold",children:"Latest"})]}),(0,t.jsxs)("p",{className:"text-gray-700 leading-relaxed mb-2",children:[(0,t.jsx)("strong",{children:"Latest Change:"})," ",n.change]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,t.jsx)("strong",{children:"Date:"})," ",n.date]})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold mb-4",children:"All Versions"}),(0,t.jsx)("div",{className:"space-y-3",children:b.slice().reverse().map((e,s)=>(0,t.jsx)("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow bg-white",children:(0,t.jsx)("div",{className:"flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsxs)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:["v",e.version]}),(0,t.jsx)("span",{className:"text-sm text-gray-500",children:e.date}),0===s&&(0,t.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold",children:"Latest"})]}),(0,t.jsx)("p",{className:"text-gray-800 font-medium mb-1",children:e.change}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.details})]})})},e.version))})]}),(0,t.jsx)(r,{id:"summary",title:"üìã Technical Summary",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("p",{className:"leading-relaxed",children:"The latest update addresses critical infrastructure stability issues that were preventing the dashboard from loading and the backend API from responding to requests. The primary focus was on resolving Docker container networking conflicts, optimizing backend startup processes, and ensuring proper service communication."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,t.jsx)("h4",{className:"font-semibold text-green-800 mb-2",children:"‚úÖ Resolved"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-green-700 text-sm",children:[(0,t.jsx)("li",{children:"Port conflict between gluetun and backend"}),(0,t.jsx)("li",{children:"Backend API timeout issues"}),(0,t.jsx)("li",{children:"Docker container restart loops"}),(0,t.jsx)("li",{children:"Network connectivity between services"})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,t.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"üîß Improved"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-blue-700 text-sm",children:[(0,t.jsx)("li",{children:"Startup event optimization"}),(0,t.jsx)("li",{children:"Database initialization process"}),(0,t.jsx)("li",{children:"Health check configuration"}),(0,t.jsx)("li",{children:"Error handling and logging"})]})]})]})]})}),(0,t.jsx)(r,{id:"docker-network",title:"üê≥ Docker Network Configuration",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Problem"}),(0,t.jsx)("p",{className:"leading-relaxed",children:'The gluetun VPN container was exposing port 8002, which conflicted with the backend service trying to bind to the same port. This caused the backend container to fail to start with "port is already allocated" errors.'}),(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900 mt-4",children:"Solution"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"Removed port 8002 from gluetun's port mappings since the backend now uses the bridge network instead of gluetun's network mode. This allows:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4 mt-2",children:[(0,t.jsx)("li",{children:"Backend to have direct access to port 8002 without conflicts"}),(0,t.jsx)("li",{children:"Telegram bot API to bypass VPN (using bridge network)"}),(0,t.jsx)("li",{children:"Crypto.com API calls to still use VPN via proxy configuration"}),(0,t.jsx)("li",{children:"Frontend to communicate with backend on standard bridge network"})]}),(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,t.jsx)("h5",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Technical Details:"}),(0,t.jsx)("pre",{className:"text-xs text-gray-700 overflow-x-auto",children:`docker-compose.yml changes:
- Removed "8002:8002/tcp" from gluetun ports
- Backend now uses bridge network (removed network_mode: "service:gluetun")
- Frontend port changed to 3001:3000 to avoid conflict with gluetun`})]})]})}),(0,t.jsx)(r,{id:"backend-startup",title:"‚ö° Backend Startup Optimization",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Problem"}),(0,t.jsx)("p",{className:"leading-relaxed",children:'The backend startup event was blocking the event loop, preventing uvicorn from responding to HTTP requests. Even though the server reported "Application startup complete", requests were timing out because background services were blocking the async event loop.'}),(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900 mt-4",children:"Solution"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"Refactored the startup event to ensure all heavy operations run in background tasks without blocking:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4 mt-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Database initialization:"})," Moved to thread pool executor to avoid blocking"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Service startup:"})," All services (exchange sync, signal monitor) now start in background tasks"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"VPN gate check:"})," Removed blocking wait_until_ok, using non-blocking monitor only"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Health endpoint:"})," Simplified to return immediately without VPN status checks"]})]}),(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,t.jsx)("h5",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Code Changes:"}),(0,t.jsx)("pre",{className:"text-xs text-gray-700 overflow-x-auto",children:`# Before: Blocking
await exchange_sync_service.start()

# After: Non-blocking
asyncio.create_task(exchange_sync_service.start())

# Database initialization in thread pool
await loop.run_in_executor(None, lambda: Base.metadata.create_all(bind=engine))`})]})]})}),(0,t.jsx)(r,{id:"health-check",title:"üíö Health Check Configuration",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Problem"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"The Docker health check was too aggressive (10s interval, 3s timeout) and was causing container restart loops. The backend needed more time to fully initialize, especially with database connections and background services."}),(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900 mt-4",children:"Solution"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"Adjusted health check parameters to be more lenient:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4 mt-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Interval:"})," Increased from 10s to 30s (less frequent checks)"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Timeout:"})," Increased from 3s to 10s (more time for response)"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Start period:"})," Increased from 20s to 60s (grace period for initialization)"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Retries:"})," Reduced from 10 to 3 (fail faster if truly broken)"]})]}),(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,t.jsx)("h5",{className:"font-semibold text-sm text-gray-900 mb-2",children:"Configuration:"}),(0,t.jsx)("pre",{className:"text-xs text-gray-700 overflow-x-auto",children:`healthcheck:
  test: ["CMD", "python", "-c", "import urllib.request;urllib.request.urlopen('http://localhost:8002/health', timeout=5)"]
  interval: 30s      # Increased from 10s
  timeout: 10s       # Increased from 3s
  retries: 3         # Reduced from 10
  start_period: 60s  # Increased from 20s`})]})]})}),(0,t.jsx)(r,{id:"frontend-backend",title:"üåê Frontend-Backend Communication",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Problem"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"After moving services to bridge network, the frontend was still configured to use port 8000, but the backend was running on port 8002. This caused API calls to fail."}),(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900 mt-4",children:"Solution"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"Updated all frontend configuration to use the correct backend port:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4 mt-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"environment.ts:"})," Updated API URL from port 8000 to 8002"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:".env.local:"})," Updated NEXT_PUBLIC_API_URL to use port 8002"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"docker-compose.yml:"})," Frontend port changed to 3001:3000"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Network:"})," Both frontend and backend on bridge network for direct communication"]})]})]})}),(0,t.jsx)(r,{id:"telegram-integration",title:"üì± Telegram Bot Integration",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Previous Fixes"}),(0,t.jsx)("p",{className:"leading-relaxed",children:"Earlier versions resolved Telegram bot connectivity issues:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4 mt-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Message formatting:"})," Changed from Markdown to HTML for proper rendering"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Scheduler startup:"})," Ensured trading scheduler runs as background task"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"VPN bypass:"})," Backend uses bridge network to bypass VPN for Telegram API"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Environment variables:"})," Proper loading of TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"/status command:"})," Enhanced to show accurate data from database"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"/analyze command:"})," Added coin selection menu functionality"]})]})]})}),(0,t.jsx)(r,{id:"technical-architecture",title:"üèóÔ∏è Technical Architecture Changes",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Network Topology"}),(0,t.jsxs)("div",{className:"ml-4 space-y-2",children:[(0,t.jsxs)("div",{className:"p-3 bg-blue-50 rounded border border-blue-200",children:[(0,t.jsx)("strong",{children:"gluetun:"})," VPN container on port 8000 (HTTP control), port 3000 (frontend proxy)"]}),(0,t.jsxs)("div",{className:"p-3 bg-green-50 rounded border border-green-200",children:[(0,t.jsx)("strong",{children:"backend:"})," Bridge network, port 8002, bypasses VPN for Telegram, uses VPN proxy for crypto.com"]}),(0,t.jsxs)("div",{className:"p-3 bg-purple-50 rounded border border-purple-200",children:[(0,t.jsx)("strong",{children:"frontend:"})," Bridge network, port 3001, directly accesses backend on port 8002"]})]}),(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900 mt-4",children:"Startup Sequence"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[(0,t.jsx)("li",{children:"Uvicorn starts and listens on port 8002"}),(0,t.jsx)("li",{children:"Startup event runs (must complete quickly)"}),(0,t.jsx)("li",{children:"Background tasks scheduled (non-blocking)"}),(0,t.jsx)("li",{children:"Database initialization in thread pool"}),(0,t.jsx)("li",{children:"Services start in background (exchange sync, signal monitor, scheduler)"}),(0,t.jsx)("li",{children:"Health endpoint becomes available"})]})]})}),(0,t.jsx)(r,{id:"future-improvements",title:"üîÆ Future Improvements",children:(0,t.jsxs)("div",{className:"space-y-4 text-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-lg text-gray-900",children:"Planned Enhancements"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-2 ml-4",children:[(0,t.jsx)("li",{children:"Implement proper connection pooling for database"}),(0,t.jsx)("li",{children:"Add request queuing for rate-limited API calls"}),(0,t.jsx)("li",{children:"Enhanced error recovery and automatic retry logic"}),(0,t.jsx)("li",{children:"Comprehensive monitoring and alerting system"}),(0,t.jsx)("li",{children:"Performance optimization for large watchlists"}),(0,t.jsx)("li",{children:"Real-time WebSocket updates for price changes"})]})]})}),(0,t.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm text-gray-600",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Current Version:"})," v",n.version]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Total Versions:"})," ",b.length]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Last Updated:"})," ",n.date]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Status:"})," Active Development"]})]})]})}e.s(["default",()=>y],43272)}]);
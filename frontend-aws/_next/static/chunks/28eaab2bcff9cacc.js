(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,17585,t=>{"use strict";let e=null,r=(e=new class t{config;healthCheckInterval=null;isLocalHealthy=!0;constructor(){this.config=this.detectEnvironment(),this.startHealthCheck()}detectEnvironment(){let t=window.location.hostname,e="localhost"===t||"127.0.0.1"===t,r=t.includes("54.254.150.31")||t.includes("ec2");return e?{apiUrl:"http://localhost:8002/api",environment:"local",isLocal:!0,isAWS:!1}:r?{apiUrl:"http://54.254.150.31:8000/api",environment:"aws",isLocal:!1,isAWS:!0}:{apiUrl:`http://${t}:8002/api`,environment:"local",isLocal:!0,isAWS:!1}}async checkLocalHealth(){try{let t=this.config.apiUrl.replace("/api","");return(await fetch(`${t}/health`,{method:"GET",signal:AbortSignal.timeout(3e3)})).ok}catch(t){return!1}}startHealthCheck(){this.config.isLocal}getConfig(){return{...this.config}}getApiUrl(){return this.config.isLocal&&!this.isLocalHealthy?"http://54.254.150.31:8002/api":this.config.apiUrl}isLocalBackendHealthy(){return this.isLocalHealthy}destroy(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}}).getApiUrl(),a=0,n=0,s=new Map;function i(t){let e=s.get(t)??0,r=Date.now();return r-e>=3e4&&(s.set(t,r),!0)}function o(t,e,r,a="error"){i(`${t}::${e}`)&&("warn"===a?console.warn:console.error)(e,r instanceof Error?{name:r.name,message:r.message,stack:r.stack}:r)}async function l(t,e){try{if(t.includes("/signals")){let t=Date.now();if(n>0&&t-n>=3e4&&(a=0,n=0),function(){let t=Date.now();if(n>0&&t-n>=3e4)return a=0,n=0,!1;if(a>=5)if(n>0&&t-n<3e4)return i("circuit-breaker-warning"),!0;else a=0,n=0;return!1}()){let e=Error("Circuit breaker open for signals endpoint");e.status=503;let r=3e4-(t-n);throw e.retryAfterMs=Math.max(0,r),e}}let s=`${r}${t}`,o=3e4;t.includes("/signals")?o=15e3:t.includes("/market/top-coins-data")?o=6e4:t.includes("/dashboard/state")?o=45e3:t.includes("/orders/history")||t.includes("/test/simulate-alert")?o=6e4:t.includes("/watchlist/")&&t.includes("/alert")?o=15e3:t.includes("/market/top-coins/custom")&&(o=3e4);let l=new AbortController,c=setTimeout(()=>{console.warn(`‚è∞ Timeout activado para ${t} despu\xe9s de ${o}ms`),l.abort()},o);Date.now();let u=await fetch(s,{...e,signal:l.signal,headers:{"Content-Type":"application/json","x-api-key":"demo-key",...e?.headers}});if(Date.now(),clearTimeout(c),!u.ok){let t=`HTTP error! status: ${u.status}`;try{let e=await u.json();e.detail?t=e.detail:e.message?t=e.message:"string"==typeof e?t=e:e.error&&(t=e.error)}catch{try{let e=await u.text();e&&(t=e)}catch{}}let e=Error(t);e.status=u.status,e.detail=t;let r=u.headers.get("retry-after");if(r){let t=Number(r);if(Number.isNaN(t)){let t=Date.parse(r);Number.isNaN(t)||(e.retryAfterMs=Math.max(0,t-Date.now()))}else e.retryAfterMs=1e3*t}throw e}let d=await u.json();return t.includes("/signals")&&(a=0,n=0),d}catch(e){if(t.includes("/signals")&&e instanceof Error){let t=e.message.includes("timeout")||e.message.includes("Request timeout")||"AbortError"===e.name;e.message.includes("Circuit breaker")||t||(a++,n=Date.now())}if(e instanceof Error){if("AbortError"===e.name){let r=30;t.includes("/signals")?r=15:t.includes("/market/top-coins-data")?r=60:t.includes("/dashboard/state")?r=45:t.includes("/orders/history")||t.includes("/test/simulate-alert")?r=60:t.includes("/watchlist/")&&t.includes("/alert")?r=10:t.includes("/market/top-coins/custom")&&(r=30),o(t,`‚è∞ API Timeout: ${t} (after ${r} seconds)`,e,"warn");let a=Error(`Request timeout for ${t}. The server may be processing the request. Please try again.`);throw a.status=408,a.retryAfterMs=5e3,a}else if(e.message.includes("Failed to fetch")){if(o(t,`üåê Network Error: ${t} (${e.message})`,e,"warn"),t.includes("/signals")||t.includes("/market/top-coins-data")||t.includes("/dashboard/state")||t.includes("/orders/history")){let e=Error(`Network error for ${t}. The server may be taking too long to respond. Please try again.`);throw e.status=0,e.retryAfterMs=3e3,e}{let r=Error(`Network error for ${t}: ${e.message}`);throw r.status=0,r.retryAfterMs=2e3,r}}}throw o(t,`API Error: ${t}`,e),e}}async function c(){try{return await l("/dashboard")||[]}catch(t){return o("getDashboard","Handled dashboard fetch failure (returning empty list)",t,"warn"),[]}}async function u(t){return await l("/dashboard",{method:"POST",body:JSON.stringify(t)})}async function d(t,e){return await l(`/dashboard/${t}`,{method:"PUT",body:JSON.stringify(e)})}async function h(t,e){try{let r=(await c()).find(e=>e.symbol===t);r?await d(r.id,{symbol:t,exchange:r.exchange||"CRYPTO_COM",buy_target:r.buy_target,take_profit:r.take_profit,stop_loss:r.stop_loss,...e}):await u({symbol:t,exchange:"CRYPTO_COM",...e})}catch(e){throw o(`saveCoinSettings:${t}`,"Handled error while saving coin settings",e,"warn"),e}}async function g(){try{return await l("/account/balance?exchange=CRYPTO_COM")||[]}catch(t){return o("getAccountBalance","Handled account balance fetch failure (returning empty list)",t,"warn"),[]}}async function f(){try{let t=await l("/orders/open");return{orders:t.orders||[],count:t.count||0}}catch(t){return o("getOpenOrders","Handled open orders fetch failure (returning empty list)",t,"warn"),{orders:[],count:0}}}async function y(t=100,e=0){try{let r=new URLSearchParams({limit:t.toString(),offset:e.toString()}),a=await l(`/orders/history?${r.toString()}`);return{orders:a.orders||[],count:a.count||0,total:a.total,has_more:a.has_more}}catch(t){return o("getOrderHistory","Handled order history fetch failure (returning empty list)",t,"warn"),{orders:[],count:0}}}async function m(){try{let t=await l("/assets");return{assets:t.assets||[],total_value_usd:t.total_value_usd||0}}catch(t){return o("getPortfolio","Handled portfolio fetch failure (returning empty data)",t,"warn"),{assets:[],total_value_usd:0}}}async function p(){try{let t=await l("/market/top-coins-data");return{coins:t.coins||[],count:t.count||0}}catch(t){throw o("getTopCoins","Handled top coins fetch failure",t,"warn"),t}}async function w(t){return await l("/market/top-coins/custom",{method:"POST",body:JSON.stringify(t)})}async function b(t){return await l(`/market/top-coins/custom/${t}`,{method:"DELETE"})}async function k(t,e){let r=null;for(let a=1;a<=2;a++)try{let r=new URLSearchParams({exchange:"CRYPTO_COM",symbol:t});return e&&Object.entries(e).forEach(([t,e])=>{void 0!==e&&r.append(t,e.toString())}),await l(`/signals?${r.toString()}`)}catch(e){if(r=e,e.message?.includes("Circuit breaker open"))return e.retryAfterMs&&e.retryAfterMs,null;if(console.warn(`‚ö†Ô∏è getTradingSignals attempt ${a}/2 failed for ${t}:`,e),a<2){let t=1e3*Math.pow(2,a);await new Promise(e=>setTimeout(e,t))}}if(r&&!r.message?.includes("Circuit breaker open")&&o(`getTradingSignals:${t}`,`‚ùå getTradingSignals exhausted retries (2)`,r,"warn"),r?.message?.includes("Circuit breaker open"))return null;throw r}async function _(){try{return await l("/data-sources/status")}catch(e){let t=e instanceof Error?e.message:String(e);return o("getDataSourcesStatus",`üåê Network issue while fetching data source status (${t})`,e,"warn"),{binance:{available:!1,priority:1,response_time:0,last_check:null},kraken:{available:!1,priority:2,response_time:0,last_check:null},crypto_com:{available:!1,priority:3,response_time:0,last_check:null},coinpaprika:{available:!1,priority:4,response_time:0,last_check:null}}}}async function C(){try{return await l("/config")}catch(t){return o("getTradingConfig","Handled trading config fetch failure",t,"warn"),null}}async function S(t,e){try{return await l(`/coins/${t}`,{method:"PUT",body:JSON.stringify(e)})}catch(e){throw o(`updateCoinConfig:${t}`,"Handled coin config update failure",e,"warn"),e}}async function T(t,e){try{return await l(`/watchlist/${t}/alert`,{method:"PUT",body:JSON.stringify({alert_enabled:e})})}catch(e){throw o(`updateWatchlistAlert:${t}`,"Handled alert update failure",e,"warn"),e}}async function $(t,e,r=!1,a){try{let n={symbol:t,signal_type:e,force_order:r};return a&&a>0&&(n.trade_amount_usd=a),await l("/test/simulate-alert",{method:"POST",body:JSON.stringify(n)})}catch(e){throw o(`simulateAlert:${t}`,"Handled alert simulation failure",e,"warn"),e}}async function O(t){try{return await l("/orders/quick",{method:"POST",body:JSON.stringify(t)})}catch(t){throw o("quickOrder","Handled quick order failure",t,"warn"),t}}async function v(){try{return await l("/dashboard/state")||{balances:[],fast_signals:[],slow_signals:[],open_orders:[],last_sync:null,bot_status:{is_running:!1,status:"stopped",reason:null}}}catch(t){return o("getDashboardState","Handled dashboard state fetch failure (returning empty state)",t,"warn"),{balances:[],fast_signals:[],slow_signals:[],open_orders:[],last_sync:null,bot_status:{is_running:!0,status:"running",reason:"Status unavailable (checking...)"}}}}t.s(["addCustomTopCoin",()=>w,"getAccountBalance",()=>g,"getDashboard",()=>c,"getDashboardState",()=>v,"getDataSourcesStatus",()=>_,"getOpenOrders",()=>f,"getOrderHistory",()=>y,"getPortfolio",()=>m,"getTopCoins",()=>p,"getTradingConfig",()=>C,"getTradingSignals",()=>k,"quickOrder",()=>O,"removeCustomTopCoin",()=>b,"saveCoinSettings",()=>h,"simulateAlert",()=>$,"updateCoinConfig",()=>S,"updateWatchlistAlert",()=>T],17585)}]);